<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ùóïùóºùóºùòÅùóòùó´ü•æ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  
  <style>
  :root{
  --font-family:'Poppins',sans-serif;

  
  --primary-color:#e74c3c;
  --secondary-color:#f39c12;
  --accent:#2D9CDB;

  
  --background-light:#F6F8FB;
  --surface-light:#FFFFFF;
  --glass-light:rgba(255,255,255,0.7);
  --text-primary-light:#1F2A37;
  --text-secondary-light:#6B7280;
  --border-light:#E5E7EB;

  
  --background-dark:#0F172A;
  --surface-dark:#111827;
  --glass-dark:rgba(17,24,39,0.6);
  --text-primary-dark:#F9FAFB;
  --text-secondary-dark:#9CA3AF;
  --border-dark:#27324A;

  
  --success:#22C55E;
  --danger:#EF4444;
  --pending:#F59E0B;

  
  --shadow-1:0 2px 10px rgba(15,23,42,.06);
  --shadow-2:0 6px 20px rgba(15,23,42,.10);
  --shadow-3:0 10px 30px rgba(15,23,42,.15);

  
  --r-sm:10px; --r-md:14px; --r-lg:18px; --r-xl:22px;

  
  --grad-brand:linear-gradient(135deg,var(--primary-color),var(--secondary-color));
  --grad-soft:linear-gradient(135deg,rgba(231,76,60,.12),rgba(243,156,18,.10));
  --grad-progress:linear-gradient(90deg,var(--primary-color),var(--secondary-color));
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{
  font-family:var(--font-family);
  -webkit-font-smoothing:antialiased;
  transition:background-color .25s,color .25s;
}
body.light-theme{background:var(--background-light);color:var(--text-primary-light)}
body.dark-theme{background:var(--background-dark);color:var(--text-primary-dark)}

#app{max-width:500px;margin:0 auto;padding-bottom:90px}
.page{display:none;padding:16px}
.page.active{display:block;animation:fadeIn .35s ease}
@keyframes fadeIn{from{opacity:.0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}


.profile-header{
  display:flex;align-items:center;gap:14px;
  padding:18px 16px;border-bottom:1px solid transparent;
  border-radius:var(--r-lg);
  backdrop-filter:blur(8px);
  box-shadow:var(--shadow-1);
  margin:14px 16px 6px;
  background:var(--grad-soft);
}
.light-theme .profile-header{border-color:var(--border-light);background:linear-gradient(135deg,rgba(255,255,255,.9),rgba(255,255,255,.75))}
.dark-theme .profile-header{border-color:var(--border-dark);background:linear-gradient(135deg,rgba(17,24,39,.72),rgba(17,24,39,.58))}

#user-photo{
  width:68px;height:68px;border-radius:50%;
  object-fit:cover;border:3px solid #1877F2;
  box-shadow:0 4px 14px rgba(24,119,242,.25)
}

.user-info{display:flex;flex-direction:column;gap:6px;flex:1}
.name-line{display:flex;align-items:center;gap:8px}
#user-name{font-size:1.25rem;font-weight:700;letter-spacing:.2px}
.verify-badge{
  position:relative;width:22px;height:22px;border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#4e9eff,#1877f2);
  box-shadow:0 0 8px rgba(24,119,242,.6);overflow:hidden;
  animation:rippleWave 2s infinite ease-in-out;
}
.verify-badge::after{content:"‚úì";color:#fff;font-weight:800;position:absolute;inset:0;display:grid;place-items:center;font-size:13px}
@keyframes rippleWave{0%,100%{box-shadow:0 0 6px rgba(24,119,242,.4),0 0 10px rgba(24,119,242,.2)}50%{box-shadow:0 0 10px rgba(24,119,242,.7),0 0 14px rgba(24,119,242,.4)}}

#user-balance-container{font-size:.92rem;color:var(--text-secondary-light)}
body.dark-theme #user-balance-container{color:var(--text-secondary-dark)}
#user-balance{font-weight:800;color:var(--primary-color)}

.popup-overlay{
  position:fixed; inset:0; z-index:10000;
  display:none; place-items:center;
  background:rgba(2,6,23,.60);           
  backdrop-filter: blur(6px);
}

.popup-content{
  width:min(92%,520px);
  padding:24px 22px;
  border-radius:20px;
  color:#f8fbff;                         
  border:1px solid rgba(255,255,255,.18);
  background:
    radial-gradient(100% 140% at 0% 0%, rgba(14,165,233,.12), rgba(14,165,233,0) 60%),
    radial-gradient(100% 140% at 100% 100%, rgba(59,130,246,.12), rgba(59,130,246,0) 60%),
    linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15);
  text-align:center;
  animation: popupIn .35s ease-out both;
}
/* force same look in both themes */
.light-theme .popup-content,
.dark-theme  .popup-content{ color:#f8fbff; }

.popup-content h2{
  margin-bottom:8px;
  font-weight:800; font-size:1.2rem;
  color:#ffffff;
  text-shadow: 0 2px 12px rgba(96,165,250,.25);
}
.popup-content p{ margin:8px 0 16px; opacity:.95; }

/* Primary action */
.popup-close-btn{
  padding:10px 18px; border:none; border-radius:12px; cursor:pointer;
  font-weight:800; letter-spacing:.2px; color:#0b1220;
  background:linear-gradient(135deg,#22d3ee 0%, #60a5fa 100%);
  box-shadow:0 10px 26px rgba(96,165,250,.35);
  transition: transform .15s ease, box-shadow .15s ease;
}
.popup-close-btn:hover{ transform:translateY(-1px); }
.popup-close-btn:active{ transform:translateY(0); box-shadow:0 8px 18px rgba(96,165,250,.35); }


.popup-loader .spinner{
  width:42px; height:42px; margin:0 auto 14px;
  border-radius:50%;
  border:4px solid;
  border-color:#60a5fa transparent;      
  animation:spin 1s linear infinite;
}
@keyframes spin{ to{ transform:rotate(360deg); } }


#app-loader{
  position:fixed; inset:0; z-index:9999;
  display:grid; place-items:center;
  color:#eaf2ff;
  
  background:
    radial-gradient(1200px 800px at 10% -10%, #1f2937 0%, rgba(31,41,55,0) 60%),
    radial-gradient(1200px 800px at 110% 110%, #0ea5e9 0%, rgba(14,165,233,0) 60%),
    linear-gradient(160deg,#0b1220 0%, #0f172a 60%, #0b1220 100%);
}
#bootex-loader,#fallback-bounce{
  display:flex; flex-direction:column; align-items:center; gap:10px;
  transform:translateY(-12px);
}
#bootex-loader{
  width:min(92%,420px);
  padding:26px 22px;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.15);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
  backdrop-filter: blur(10px);
  box-shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15);
  text-align:center;
  animation: riseIn .45s ease-out both;
}

#lottie-box{ width:120px; height:120px; }
.loader-title{ font-size:1.28rem; font-weight:800; letter-spacing:.2px; }
#loader-text,.hint{ opacity:.9; font-size:.95rem; }

#fallback-bounce{ display:none; }
.boot-icon{ font-size:56px; animation:bounce 1.05s ease-in-out infinite; }
@keyframes bounce{ 0%,100%{transform:translateY(0) scale(1)} 50%{transform:translateY(-12px) scale(1.02)} }

.loader-hide{ animation:loaderFade .35s ease forwards; }
@keyframes loaderFade{ to{opacity:0; visibility:hidden;} }


@keyframes riseIn{
  from{ opacity:0; transform: translateY(14px) scale(.98); }
  to  { opacity:1; transform: translateY(0)   scale(1); }
}
@keyframes popupIn{
  from{ opacity:0; transform: translateY(10px) scale(.98); }
  to  { opacity:1; transform: translateY(0)    scale(1); }
}


#loader-line{
  height:6px; width:100%; margin-top:14px; border-radius:999px; overflow:hidden;
  background: rgba(255,255,255,.14);
}
#loader-line::after{
  content:""; display:block; height:100%; width:40%;
  background: linear-gradient(90deg,#22d3ee,#60a5fa,#22d3ee);
  border-radius:inherit; animation: slideLine 1.2s ease-in-out infinite;
}
@keyframes slideLine{
  0%{ transform:translateX(-40%); }
  50%{ transform:translateX(30%); }
  100%{ transform:translateX(120%); }
}


@media (prefers-reduced-motion: reduce){
  #bootex-loader, .popup-content{ animation:none !important; }
  #loader-line::after{ animation-duration:2.2s; }
}


@media (max-width:360px){
  #bootex-loader{ padding:22px 18px; }
  .loader-title{ font-size:1.16rem; }
  #lottie-box{ width:100px; height:100px; }
}

    
.bottom-nav{
  position:fixed;left:0;right:0;bottom:0;max-width:500px;margin:0 auto;
  display:grid;grid-template-columns:1fr 1fr auto 1fr 1fr;gap:6px;
  padding:10px 12px;border-top-left-radius:16px;border-top-right-radius:16px;
  background:var(--grad-brand);
  border:none;box-shadow:0 -8px 24px rgba(231,76,60,.25), inset 0 1px 0 rgba(255,255,255,.2);
  backdrop-filter:blur(8px);z-index:1000;
}
.bottom-nav .nav-btn{color:#fff !important;opacity:.92;transition:transform .18s ease, opacity .18s}
.bottom-nav .nav-btn:hover{opacity:1;transform:translateY(-2px)}
.bottom-nav .nav-btn.active i{transform:scale(1.08)}
.nav-btn{background:none;border:none;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:.78rem}
.nav-btn i{font-size:1.35rem}
.home-fab{
  position:relative;top:-22px;width:66px;height:66px;border-radius:50%;
  border:3px solid rgba(255,255,255,.5);
  box-shadow:0 6px 20px rgba(0,0,0,.20), inset 0 1px 0 rgba(255,255,255,.6);
  color:var(--primary-color)!important;background:linear-gradient(135deg,#fff,#fff)
}
.home-fab.active{background:var(--grad-brand);color:#fff !important;box-shadow:0 0 18px rgba(255,255,255,.5)}
.home-fab:active{transform:scale(.97)}

.neo-header-box{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  padding:16px;border-radius:var(--r-lg);border:1px solid;
  margin:14px 0 16px;box-shadow:var(--shadow-1)
}
.light-theme .neo-header-box{background:#fff;border-color:var(--border-light)}
.dark-theme  .neo-header-box{background:#111827;border-color:var(--border-dark)}
.neo-title{font-size:1.15rem;font-weight:800}
.neo-sub{font-size:.92rem;opacity:.8}
.neo-balance-box{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  border:1px dashed var(--primary-color);border-radius:12px;padding:10px 16px;min-width:110px;
  background:linear-gradient(135deg,rgba(231,76,60,.06),rgba(243,156,18,.05))
}
.neo-balance-top{display:flex;align-items:center;gap:6px;font-size:.86rem;opacity:.85}
.neo-balance-symbol{font-weight:800;color:var(--primary-color)}
.neo-balance-amount{font-size:1.35rem;font-weight:900;color:var(--primary-color);line-height:1}


.neo-stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:18px}
.neo-card{
  border:1px solid;border-radius:14px;padding:14px;text-align:center;
  transition:transform .18s ease, box-shadow .18s ease;box-shadow:var(--shadow-1)
}
.light-theme .neo-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .neo-card{background:#111827;border-color:var(--border-dark)}
.neo-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-2)}
.neo-icon{font-size:1.5rem;color:var(--primary-color);margin-bottom:6px}
.neo-card h4{font-size:.92rem;margin-bottom:4px;opacity:.85}
.neo-card p{font-size:1.08rem;font-weight:800}


.neo-graph-box{
  border:1px solid;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:var(--shadow-1)
}
.light-theme .neo-graph-box{background:#fff;border-color:var(--border-light)}
.dark-theme  .neo-graph-box{background:#111827;border-color:var(--border-dark)}
.neo-graph-box h3{font-size:1rem;margin-bottom:10px}


.chart{
  display:flex;justify-content:space-around;align-items:flex-end;height:160px;
  border-left:1px dashed;border-bottom:1px dashed;padding:10px 6px 8px 6px;
  border-radius:10px;background:linear-gradient(180deg,transparent,rgba(0,0,0,.02))
}
.light-theme .chart{border-color:var(--border-light)}
.dark-theme  .chart{border-color:var(--border-dark)}
.bar{
  width:12%;border-radius:8px 8px 0 0;position:relative;cursor:pointer;
  background:var(--grad-brand);box-shadow:0 6px 16px rgba(231,76,60,.22);
  transition:transform .16s ease, box-shadow .16s ease, opacity .16s ease
}
.bar:hover{transform:translateY(-3px);box-shadow:0 10px 22px rgba(231,76,60,.28)}
.bar .tooltip{
  position:absolute;top:-30px;left:50%;transform:translateX(-50%);
  background:#111827;color:#fff;padding:4px 8px;border-radius:8px;font-size:.78rem;white-space:nowrap;opacity:0;transition:opacity .18s
}
.light-theme .bar .tooltip{background:#111827}
.dark-theme  .bar .tooltip{background:#374151}
.bar:hover .tooltip{opacity:1}
.chart-labels{display:flex;justify-content:space-around;font-size:.76rem;margin-top:6px;opacity:.85}


.progress-container{margin-bottom:18px}
.progress-info{display:flex;justify-content:space-between;margin-bottom:6px;font-size:.92rem;font-weight:600}
.progress-bar-bg{
  width:100%;height:11px;border-radius:999px;
  background:linear-gradient(90deg,rgba(0,0,0,.06),rgba(0,0,0,.04))
}
.dark-theme .progress-bar-bg{background:linear-gradient(90deg,rgba(255,255,255,.10),rgba(255,255,255,.06))}
.progress-bar-fg{
  height:100%;border-radius:999px;background:var(--grad-progress);
  transition:width .35s cubic-bezier(.4,0,.2,1)
}


.wallet-card,.progress-card{
  border:1px solid;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:var(--shadow-1)
}
.light-theme .wallet-card,.light-theme .progress-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .wallet-card,.dark-theme  .progress-card{background:#111827;border-color:var(--border-dark)}
.wallet-head h3,.progress-head h3{font-size:1.02rem}

.wallet-amount-box{
  display:flex;flex-direction:column;align-items:center;gap:6px;
  padding:12px;border:1px dashed var(--primary-color);border-radius:14px;
  background:linear-gradient(135deg,rgba(231,76,60,.06),rgba(243,156,18,.05))
}
.wallet-amount-top{display:flex;align-items:center;gap:6px;font-size:.9rem;opacity:.85}
.wallet-label{font-weight:700}
.wallet-symbol{font-weight:800;color:var(--primary-color)}
.wallet-amount-value{font-size:1.8rem;font-weight:900;color:var(--primary-color);line-height:1.1}
.wallet-note{display:block;margin-top:10px;opacity:.85}
.wallet-btn{width:100%;margin-top:12px}

.tasks-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.task-container{
  padding:16px;border-radius:16px;margin-bottom:14px;display:flex;align-items:center;gap:14px;
  border:1px solid;transition:transform .16s ease, box-shadow .16s ease;box-shadow:var(--shadow-1)
}
.light-theme .task-container{background:#fff;border-color:var(--border-light)}
.dark-theme  .task-container{background:#111827;border-color:var(--border-dark)}
.task-container:hover{transform:translateY(-2px);box-shadow:var(--shadow-2)}

.task-icon-img{
  width:50px;height:50px;border-radius:12px;object-fit:cover;
  border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,.25)
}
.task-info h3{font-size:1.02rem;font-weight:700}
.task-info p{font-size:.9rem;opacity:.9}
.action-btn{
  padding:10px 18px;font-size:.92rem;font-weight:800;color:#fff;border:none;border-radius:12px;cursor:pointer;
  background:var(--grad-brand);box-shadow:0 6px 16px rgba(231,76,60,.25);transition:transform .15s ease, box-shadow .15s ease;margin-left:auto;white-space:nowrap
}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(231,76,60,.32)}
.action-btn:disabled{background:#9CA3AF;box-shadow:none;cursor:not-allowed}

/* Leaderboard */
.leaderboard-toggle{display:flex;justify-content:space-around;margin:6px 0 14px}
.toggle-btn{padding:10px 20px;border:none;background:none;font-size:1rem;cursor:pointer;color:inherit;opacity:.8}
.toggle-btn.active{font-weight:800;color:var(--primary-color);border-bottom:2px solid var(--primary-color);opacity:1}
.leaderboard-list{list-style:none}
.leaderboard-item{
  display:flex;align-items:center;padding:10px;margin-bottom:10px;border-radius:14px;border:1px solid;box-shadow:var(--shadow-1)
}
.light-theme .leaderboard-item{background:#fff;border-color:var(--border-light)}
.dark-theme  .leaderboard-item{background:#111827;border-color:var(--border-dark)}
.rank{width:42px;text-align:center;font-weight:900;color:var(--primary-color)}
.leaderboard-item img{
  width:46px;height:46px;border-radius:50%;object-fit:cover;
  border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,.2);margin-right:10px
}
.leaderboard-name{font-weight:700;flex-grow:1}
.leaderboard-score{font-weight:800;color:var(--secondary-color)}

/* History (withdrawals) */
.history-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px;border-radius:14px;margin-bottom:10px;border:1px solid;box-shadow:var(--shadow-1)
}
.light-theme .history-item{background:#fff;border-color:var(--border-light)}
.dark-theme  .history-item{background:#111827;border-color:var(--border-dark)}
.history-details p{margin:0}
.history-details p:first-child{font-weight:700}
.history-status{
  padding:6px 12px;border-radius:999px;font-size:.82rem;font-weight:800;color:#fff;text-transform:capitalize
}
.status-completed{background:var(--success)}
.status-pending{background:var(--pending)}
.status-rejected{background:var(--danger)}

/* Forms */
form input,form select,form textarea{
  width:100%;padding:12px;border-radius:12px;border:1px solid;transition:all .18s ease;
  background:rgba(255,255,255,.9);font-size:.95rem
}
.light-theme form input,.light-theme form select,.light-theme form textarea{border-color:var(--border-light)}
.dark-theme  form input,.dark-theme  form select,.dark-theme  form textarea{border-color:var(--border-dark);background:rgba(17,24,39,.9);color:var(--text-primary-dark)}
form input:focus,form select:focus,form textarea:focus{
  outline:none;border-color:var(--primary-color)!important;box-shadow:0 0 0 4px rgba(231,76,60,.18)
}

/* Support */
.support-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.support-card{
  border:1px solid;border-radius:16px;padding:16px;text-align:center;box-shadow:var(--shadow-1)
}
.light-theme .support-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .support-card{background:#111827;border-color:var(--border-dark)}
.support-icon{font-size:2rem;color:var(--primary-color);margin-bottom:6px}
.faq-hint{margin-top:10px;opacity:.85;text-align:center}
.hint-badge{
  display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;
  background:var(--grad-brand);color:#fff;font-size:.82rem;font-weight:800
}

/* Profile layout */
.grid-two{display:grid;grid-template-columns:1fr;gap:12px}
@media (min-width:420px){.grid-two{grid-template-columns:1fr 1fr}} 
    
.stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin:18px 0}
.stat-card{
  padding:14px;border-radius:14px;text-align:center;border:1px solid;box-shadow:var(--shadow-1)
}
.light-theme .stat-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .stat-card{background:#111827;border-color:var(--border-dark)}
.stat-card h3{font-size:.84rem;font-weight:600;margin-bottom:8px;opacity:.8;text-transform:uppercase}
.stat-card p{font-size:1.22rem;font-weight:800;color:var(--primary-color)}

.chart-container,.earning-wallet-card{
  padding:16px;border-radius:16px;margin-top:16px;border:1px solid;box-shadow:var(--shadow-1)
}
.light-theme .chart-container,.light-theme .earning-wallet-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .chart-container,.dark-theme  .earning-wallet-card{background:#111827;border-color:var(--border-dark)}


.horizontal-cards{
  display:grid;grid-auto-flow:column;grid-auto-columns:80%;
  gap:14px;overflow-x:auto;scroll-snap-type:x mandatory;padding:6px 2px 2px 2px
}
.horizontal-cards::-webkit-scrollbar{display:none}
.kpi-card{
  scroll-snap-align:start;padding:18px;border-radius:16px;border:1px solid;backdrop-filter:blur(6px);box-shadow:var(--shadow-1)
}
.light-theme .kpi-card{background:rgba(255,255,255,.9);border-color:var(--border-light)}
.dark-theme  .kpi-card{background:rgba(17,24,39,.75);border-color:var(--border-dark)}
.kpi-title{font-size:.9rem;opacity:.8;margin-bottom:6px}
.kpi-value{font-size:1.55rem;font-weight:900}

.ring-and-actions{display:flex;gap:16px;align-items:center;margin:18px 0 6px}
.progress-ring{position:relative;width:120px;height:120px}
.progress-ring svg{transform:rotate(-90deg)}
.ring-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:800}
.ring-center small{opacity:.75;font-weight:700}
.ring-bg{stroke:rgba(127,140,141,.28)}
.ring-fg{stroke:url(#ringGradient);transition:stroke-dashoffset .4s ease}

.quick-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;flex:1}
.qa{
  display:flex;align-items:center;gap:10px;padding:12px;border-radius:14px;border:1px solid;
  cursor:pointer;user-select:none;font-weight:800;box-shadow:var(--shadow-1)
}
.light-theme .qa{background:#fff;border-color:var(--border-light)}
.dark-theme  .qa{background:#111827;border-color:var(--border-dark)}
.qa i{font-size:1.2rem}
.qa.primary{color:#fff;background:var(--grad-brand);border:none;box-shadow:0 8px 18px rgba(231,76,60,.28)}

.mini-leader{margin-top:8px}
.mini-leader h3{margin:6px 0 10px}
.mini-row{
  display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;border:1px solid;margin-bottom:8px;box-shadow:var(--shadow-1)
}
.light-theme .mini-row{background:#fff;border-color:var(--border-light)}
.dark-theme  .mini-row{background:#111827;border-color:var(--border-dark)}
.mini-rank{width:28px;text-align:center;font-weight:900;color:var(--primary-color)}
.mini-row img{width:32px;height:32px;border-radius:50%;object-fit:cover}

.lb-hero{display:flex;gap:10px;justify-content:space-around;margin:10px 0 14px}
.medal{width:70px;height:70px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.05rem;font-weight:900}
.medal.gold{background:linear-gradient(135deg,#f1c40f,#f39c12)}
.medal.silver{background:linear-gradient(135deg,#bdc3c7,#95a5a6)}
.medal.bronze{background:linear-gradient(135deg,#d35400,#e67e22)}

.profile-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0}
.prof-card{padding:14px;border:1px solid;border-radius:16px;box-shadow:var(--shadow-1)}
.light-theme .prof-card{background:#fff;border-color:var(--border-light)}
.dark-theme  .prof-card{background:#111827;border-color:var(--border-dark)}
.prof-card h4{font-size:.86rem;opacity:.85;margin-bottom:6px}
.prof-card .num{font-size:1.35rem;font-weight:900}

/* Floating bubbles */
.support-wrap{position:relative;overflow:hidden}
.bubble{position:absolute;border-radius:50%;filter:blur(8px);opacity:.14;animation:float 8s infinite ease-in-out}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}

/* ====== Floating CTA ====== */
.floating-cta{
  position:fixed;right:16px;bottom:92px;display:flex;align-items:center;gap:10px;z-index:1201;pointer-events:auto
}
.cta-refer{
  display:inline-flex;align-items:center;gap:8px;height:44px;padding:0 14px;border:none;border-radius:999px;
  font-weight:900;color:#fff;background:var(--grad-brand);
  box-shadow:0 10px 22px rgba(231,76,60,.25);transition:transform .15s ease, box-shadow .15s ease
}
.cta-refer i{font-size:1.1rem;line-height:1}
.cta-refer:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(231,76,60,.22)}

.cta-help{
  width:42px;height:42px;border-radius:50%;border:none;color:#fff;font-weight:900;background:var(--accent);
  box-shadow:0 8px 20px rgba(45,156,219,.25);transition:transform .15s ease, box-shadow .15s ease
}
.cta-help:active{transform:translateY(1px);box-shadow:0 6px 16px rgba(45,156,219,.22)}

@media (max-width:360px){
  .cta-refer span{display:none}
  .cta-refer{width:46px;justify-content:center;padding:0}
} 
    
/* body color */
body{ color:#E9EEF7 !important; }
body.light-theme, body.dark-theme{
  background:
    radial-gradient(1100px 500px at -10% -10%, rgba(72,187,255,.10), transparent 60%),
    radial-gradient(900px 400px at 110% 0%, rgba(120,119,198,.14), transparent 55%),
    linear-gradient(135deg, #0F172A, #162447 55%, #1F4068);
  color:#E9EEF7 !important;
}


.neo-header-box,
.neo-card,
.neo-graph-box,
.wallet-card,
.progress-card,
.task-container,
.leaderboard-item,
.history-item,
.support-card,
.stat-card,
.chart-container,
.earning-wallet-card,
.prof-card,
.kpi-card,
.mini-row{
  background: rgba(255,255,255,.05) !important;
  border:1px solid rgba(255,255,255,.14) !important;
  box-shadow: 0 8px 24px rgba(0,0,0,.24) !important;
  color:#ffffff !important;
  backdrop-filter: blur(8px);
}


.profile-header{
  background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04)) !important;
  border:1px solid rgba(255,255,255,.12) !important;
}


.bottom-nav{ background: linear-gradient(135deg,#0EA5E9,#8B5CF6) !important; }
.bottom-nav .nav-btn{ color:#fff !important; opacity:.95; }
.home-fab{ background:#ffffff10 !important; color:#fff !important; border-color:rgba(255,255,255,.35)!important; }


#user-name,
.neo-title,
.task-info h3,
.wallet-head h3,
.progress-head h3,
.leaderboard-name,
.history-details p:first-child,
.prof-card .num{ color:#FFFFFF !important; }

.neo-sub,
.task-info p,
#user-balance-container,
.faq-hint,
.chart-labels,
.history-details small{ color:rgba(255,255,255,.78) !important; }


.action-btn,
.qa.primary{ 
  background: linear-gradient(135deg,#22D3EE,#A78BFA) !important; 
  color:#fff !important; 
  box-shadow:0 10px 24px rgba(167,139,250,.28) !important;
}
.action-btn:disabled{ background:#64748B !important; }


form input, form select, form textarea{
  background: rgba(255,255,255,.06) !important;
  border:1px solid rgba(255,255,255,.18) !important;
  color:#fff !important;
}
form input::placeholder, form textarea::placeholder{ color:rgba(255,255,255,.55); }
form input:focus, form select:focus, form textarea:focus{
  border-color:#22D3EE !important;
  box-shadow:0 0 0 4px rgba(34,211,238,.18) !important;
}


.chart{ border-color: rgba(255,255,255,.14) !important; }
.bar{
  background: linear-gradient(180deg,#22D3EE,#0EA5E9) !important;
  box-shadow:0 10px 22px rgba(14,165,233,.28) !important;
}
.bar .tooltip{ background: rgba(15,23,42,.92) !important; color:#fff !important; }
.chart-labels{ color:rgba(255,255,255,.78) !important; }


#user-balance{ color:#22D3EE !important; }
.verify-badge{ box-shadow:0 0 10px rgba(59,130,246,.65) !important; }


.floating-cta .cta-refer{ background: linear-gradient(135deg,#22D3EE,#A78BFA) !important; }
.floating-cta .cta-help{ background:#0EA5E9 !important; }


.status-completed{ background:#22C55E !important; }
.status-pending{ background:#F59E0B !important; }
.status-rejected{ background:#EF4444 !important; } 
    
.profile-header,
.elegant-header,
.neo-header-box {
  background:#FFFFFF !important;
  border:1px solid rgba(15,23,42,.10) !important;
  box-shadow: 0 10px 28px rgba(2,6,23,.06) !important;
  color:#0F172A !important; 
}

/* Text colors inside the header */
.profile-header #user-name,
.elegant-header #user-name { 
  color:#0F172A !important;
}

#user-balance-container{ 
  color:#334155 !important; 
}
#user-balance{ 
  color:#0EA5E9 !important; /* accent on amount */
}

/* Round photo ring to match white card */
#user-photo{ 
  border-color:#0EA5E9 !important; 
}

/* (optional) verified badge looks better on white */
.verify-badge{ 
  box-shadow:0 0 8px rgba(14,165,233,.45) !important; 
} 
    


.earning-wallet-card {
  background: rgba(255,255,255,0.05) !important;   /* ‡¶ó‡ßç‡¶≤‡¶æ‡¶∏ ‡¶°‡¶æ‡¶∞‡ßç‡¶ï */
  border: 1px solid rgba(255,255,255,0.15) !important;
  color: #fff !important;
  backdrop-filter: blur(8px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  text-align: center; 
}

/* ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶ì ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶Æ‡¶æ‡¶ù‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã */
.earning-wallet-card h3,
.earning-wallet-card p,
.earning-wallet-card small {
  text-align: center !important;
  width: 100%;
}

/* ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶Ü‡¶∞ ‚ÄúBalance ‡ß≥‚Äù ‡¶∞‡¶ô ‡¶π‡¶æ‡¶á‡¶≤‡¶æ‡¶á‡¶ü */
.earning-wallet-card h3 {
  color: #f0f4ff !important;
  font-weight: 700;
}
.earning-wallet-card p {
  color: #00BFFF !important;   /* ‡¶≤‡¶æ‡¶á‡¶ü ‡¶¨‡ßç‡¶≤‡ßÅ */
  font-size: 1.8rem !important;
  font-weight: 800 !important;
}

/* ‡¶õ‡ßã‡¶ü ‡¶®‡ßã‡¶ü‡ßá‡¶∞ ‡¶≤‡ßá‡¶ñ‡¶æ‡¶ü‡¶æ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶∏‡¶´‡¶ü */
.earning-wallet-card small {
  opacity: 0.85;
  color: #e5e7eb !important;
}


.earning-wallet-card .action-btn {
  margin-top: 12px;
  width: 100%;
  background: linear-gradient(135deg,#00BFFF,#1E90FF);
  border: none;
  color: #fff;
  font-weight: 700;
  box-shadow: 0 6px 18px rgba(30,144,255,.25);
}
.earning-wallet-card .action-btn:disabled {
  background: rgba(255,255,255,0.1);
  color: rgba(255,255,255,0.4);
} 
    
  </style>
  
</head>
<body>

    <div id="app-loader">
      <div id="bootex-loader">
        <div id="lottie-box"></div>
        <div class="loader-title">BootEX <span>ü•æ</span></div>
        <p id="loader-text">Preparing BootEX‚Ä¶</p>
      </div>
      <div id="fallback-bounce" aria-hidden="true">
        <div class="boot-icon">ü•æ</div>
        <div class="loader-title">BootEX</div>
        <p class="hint">Getting things ready‚Ä¶</p>
      </div>
    </div>

    <div id="popup" class="popup-overlay"><div class="popup-content"><div id="popup-body"></div></div></div>
    <div id="app" style="display: none;">
    
    <header class="profile-header elegant-header d-flex align-items-center p-3 bg-white rounded shadow-sm">

  <!-- ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø -->
  <img id="user-photo" src="https://via.placeholder.com/60" alt="User" class="profile-photo me-3">

  <!-- ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶®‡ßç‡¶∏ -->
  <div class="user-info flex-grow-1">
    <div class="name-line d-flex align-items-center">
      <h1 id="user-name" class="me-2 mb-0 fs-4 fw-semibold">Loading...</h1>

      <!-- ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶á‡¶Æ‡ßá‡¶ú -->
      <img src="https://trickbd.com/wp-content/uploads/2025/10/27/IMG_20251027_222438-removebg-preview.png" alt="verified" class="verify-img">
    </div>

    <div id="user-balance-container" class="text-muted mt-1">
      ‡¶Æ‡ßÇ‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="user-balance" class="fw-bold text-success">‡ß≥0.00</span> ‡¶ü‡¶æ‡¶ï‡¶æ
    </div>
  </div>

</header>

<style>
.profile-header {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

.profile-photo {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #0d6efd;
}

.verify-img {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  object-fit: cover;
}

.user-info h1 {
  font-family: 'Poppins', sans-serif;
} 
  
.bottom-nav {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  border-top: none;
  box-shadow: 0 -3px 15px rgba(0,0,0,0.15);
}

/* ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ nav ‡¶¨‡¶æ‡¶ü‡¶® */
.bottom-nav .nav-btn {
  background: none;
  border: none;
  color: #fff;
  opacity: 0.85;
  font-size: 0.78rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  transition: all 0.25s ease;
}

/* ‡¶Ü‡¶á‡¶ï‡¶® */
.bottom-nav .nav-btn i {
  font-size: 1.35rem;
}

/* ‡¶π‡ßã‡¶≠‡¶æ‡¶∞ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
.bottom-nav .nav-btn:hover {
  opacity: 1;
  transform: translateY(-2px);
}

/* ===== HOME BUTTON ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ===== */
.home-fab {
  position: relative;
  top: -20px;
  width: 68px;
  height: 68px;
  border-radius: 50%;
  background: linear-gradient(135deg, #ffffff, #ffffff);
  color: var(--primary-color) !important;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  border: 3px solid rgba(255, 255, 255, 0.5);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

/* active glow ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
.home-fab.active {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: #fff !important;
  box-shadow: 0 0 18px rgba(255, 255, 255, 0.5);
}

/* ‡¶π‡ßã‡¶Æ ‡¶Ü‡¶á‡¶ï‡¶® ‡¶¨‡¶°‡¶º ‡¶ì ‡¶ï‡ßá‡¶®‡ßç‡¶¶‡ßç‡¶∞‡¶¨‡¶ø‡¶®‡ßç‡¶¶‡ßÅ‡¶§‡ßá */
.home-fab i {
  font-size: 1.5rem;
}
.home-fab span {
  font-weight: 600;
  font-size: 0.8rem;
}

/* ‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶∏‡ßç‡¶ï‡ßá‡¶≤ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü */
.home-fab:active {
  transform: scale(0.96); 
} 
  /* Force neo-header text color black */

.neo-header-box .neo-title,

.neo-header-box .neo-sub {

  color: #000 !important;

}
</style>  
      <main id="main-content">
  <!-- =======================
       ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú
       ======================= -->
  <div id="home-page" class="page active">
    <!-- ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ + ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¨‡¶ï‡ßç‡¶∏ -->
    <div class="neo-header-box">
      <div>
        <div class="neo-title">BootEX ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</div>
        <div class="neo-sub">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂ ‡¶ì ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶≤‡¶æ‡¶™ ‡¶è‡¶ï ‡¶ú‡¶æ‡¶Ø‡¶º‡¶ó‡¶æ‡¶Ø‡¶º</div>
      </div>
     
    </div>

    <!-- KPI ‡¶ï‡¶æ‡¶∞‡ßç‡¶°‡¶∏‡¶Æ‡ßÇ‡¶π -->
    <div class="neo-stats-grid">
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-bullseye"></i></div>
        <h4>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°</h4>
        <p id="daily-ads-watched">0 / 0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-user-plus"></i></div>
        <h4>‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤</h4>
        <p id="referral-count">0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-eye"></i></div>
        <h4>‡¶Æ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ</h4>
        <p id="total-ads-watched">0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-sack-dollar"></i></div>
        <h4>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</h4>
        <p id="total-earned">0.00</p>
      </div>
    </div>

    <!-- ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶´ -->
    <div id="earnings-graph-container" class="neo-graph-box">
      <h3>‡¶ó‡¶§ ‡ß≠ ‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶Ü‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡¶æ‡¶´</h3>
      <div id="earnings-chart" class="chart"></div>
      <div id="earnings-chart-labels" class="chart-labels"></div>
    </div>

    <!-- ‡¶°‡¶æ‡¶á‡¶®‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶∏‡¶Æ‡ßÇ‡¶π (JS ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶¨‡ßá) -->
    <div id="dynamic-links-container" class="neo-links-box"></div>
  </div>

  <!-- =======================
       ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶∏ ‡¶™‡ßá‡¶ú
       ======================= -->
  <div id="tasks-page" class="page">
    <!-- ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü -->
    <div class="wallet-card">
      <div class="wallet-head"><h3>‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü</h3></div>

      <div class="wallet-amount-box">
        <div class="wallet-amount-top">
          <span class="wallet-label">Balance</span>
          <span class="wallet-symbol">‡ß≥</span>
        </div>
        <div class="wallet-amount-value">
          <span id="earning-wallet-balance">0.00</span>
        </div>
      </div>

      <small class="wallet-note">‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</small>
      <button id="move-to-balance-btn" class="action-btn wallet-btn" disabled>
        ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶®
      </button>
    </div>

    <!-- ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø -->
    <div class="progress-card">
      <div class="progress-head"><h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏</h3></div>
      <div id="ad-progress-container" class="progress-container"></div>
    </div>

    <!-- ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï (JS ‡¶≠‡¶∞‡¶¨‡ßá) -->
    <div id="ad-task-container" style="margin-top:16px;"></div>

    <!-- ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶∏‡¶Æ‡ßÇ‡¶π -->
    <h2 style="margin:16px 0 10px;">‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</h2>
    <div id="dynamic-tasks-container" class="tasks-grid"></div>
  </div>

  <!-- =======================
       ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶™‡ßá‡¶ú
       ======================= -->
  <div id="leaderboard-page" class="page">
    <h2 style="margin-bottom:10px;">‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2>

    <div class="leaderboard-toggle">
      <button class="toggle-btn active" data-board="referral">‡¶∂‡ßÄ‡¶∞‡ßç‡¶∑ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶∞</button>
      <button class="toggle-btn" data-board="earning">‡¶∂‡ßÄ‡¶∞‡ßç‡¶∑ ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ</button>
    </div>

    <div id="referral-board">
      <ul class="leaderboard-list modern" id="referral-leaderboard-list"></ul>
    </div>

    <div id="earning-board" style="display:none;">
      <ul class="leaderboard-list modern" id="earning-leaderboard-list"></ul>
    </div>
  </div>

  <!-- =======================
       ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡ßá‡¶ú
       ======================= -->
  <div id="support-page" class="page">
    <h2 style="margin-bottom:10px;">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>

    <div class="task-container" style="flex-direction:column;align-items:stretch;">
      <h3>‡¶π‡ßá‡¶≤‡ßç‡¶™ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞?</h3>
      <p>‡¶Ø‡ßá‡¶ï‡ßã‡¶® ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ü‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:</p>

   
      
<div class="support-grid" style="margin-top:10px;">
  <button id="btn-support-tg" class="action-btn">
    <i class="fa-brands fa-telegram"></i>&nbsp; ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ
  </button>
  <button id="btn-support-mail" class="action-btn">
    <i class="fa-regular fa-envelope"></i>&nbsp; ‡¶á‡¶Æ‡ßá‡¶á‡¶≤
  </button>
</div>
      <small class="faq-hint">‡¶ü‡¶ø‡¶™‡¶∏: ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶•‡¶æ‡¶ï‡¶æ FAQ ‡¶Ü‡¶ó‡ßá ‡¶¶‡ßá‡¶ñ‡ßá ‡¶®‡¶ø‡¶®‡•§</small>
    </div>
  </div>

  
  <div id="profile-page" class="page">

    <!-- ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® (JS ‡¶≠‡¶∞‡¶¨‡ßá) -->
    <div id="withdraw-section" style="margin-top:12px;"></div>

    <!-- ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø -->
    <div id="withdrawal-history-section" style="margin-top:20px;">
      <h2>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶æ‡¶≤ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h2>
      <div id="withdrawal-history-list" class="history-list modern"></div>
    </div>
  </div> 
        

<div class="floating-cta">

  <button class="cta-refer" data-page="refer-page">

    <i class="fa-solid fa-user-friends"></i>

    <span>Refer & Earn</span>

  </button>

  <button class="cta-help" data-page="support-page">?</button>

</div> 
        <!-- =======================
     ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú
     ======================= -->
<div id="refer-page" class="page">
  <div class="wallet-card" style="margin-bottom:14px;">
    <h3>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶ì ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®!</h3>
    <p style="opacity:.85">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§</p>

    <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï -->
    <div class="wallet-amount-box" style="margin: 10px 0;">
      <div class="wallet-amount-top">
        <span class="wallet-label">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï</span>
      </div>
        <div id="referral-section"></div>
    </div>
  </div>

  <div class="progress-card">
    <h3>‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶®‡¶æ</h3>
    <ul style="padding-left:20px;line-height:1.7;">
      <li>‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶è‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡•§</li>
      <li>‡¶§‡¶æ‡¶∞‡¶æ ‡¶¨‡¶ü ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</li>
      
    </ul>
  </div>
</div> 
        
</main>
      
    
      
      <nav class="bottom-nav">
  <button class="nav-btn" data-page="tasks-page">
    <i class="fas fa-briefcase"></i>
    <span>Tasks</span>
  </button>

  <button class="nav-btn" data-page="leaderboard-page">
    <i class="fas fa-medal"></i>
    <span>Top List</span>
  </button>

  <button class="nav-btn home-fab active" data-page="home-page" aria-label="Home">
    <i class="fas fa-house-chimney"></i>
    <span>Home</span>
  </button>

  <button class="nav-btn" data-page="support-page">
    <i class="fas fa-comments"></i>
    <span>Support</span>
  </button>

  <button class="nav-btn" data-page="profile-page">
    <i class="fas fa-wallet"></i>
    <span>Withdraw</span>
  </button>
</nav>
    </div>

    <!-- Firebase & Telegram -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- NEW: Lottie runtime -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-arB9xF9n6M4ywU5M0Qw5Y0VlcMN60o3PG9mCqOoxv7cU79cUeOizlM0drm1e2Qh4f6bXcBUFqcb8QWxj1nH99Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
   <script>  
// -----------------------------  
// data-page ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü  
// -----------------------------  
document.querySelectorAll('[data-page]').forEach(btn=>{  
  btn.addEventListener('click', ()=>{  
    const target = btn.getAttribute('data-page');  
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));  
    document.getElementById(target).classList.add('active');  
  });  
});  
  
document.addEventListener('DOMContentLoaded', () => {  
  const tg = window.Telegram.WebApp;  
  
  /* ---------- NEW: Brand Loader Controller ---------- */  
  let lottiePlayer = null;  
  function startBrandLoader() {  
    const box = document.getElementById('lottie-box');  
    const fb  = document.getElementById('fallback-bounce');  
    try {  
      lottiePlayer = lottie.loadAnimation({  
        container: box,  
        renderer: 'svg',  
        loop: true,  
        autoplay: true,    
        path: 'https://assets9.lottiefiles.com/packages/lf20_j1adxtyb.json'  
      });  
      fb.style.display = 'none';  
    } catch(e) {  
      fb.style.display = 'flex'; // fallback bounce  
    }  
  }  
  function stopBrandLoader() {  
    try { lottiePlayer && lottiePlayer.destroy && lottiePlayer.destroy(); } catch(e){}  
    const loader = document.getElementById('app-loader');  
    loader.classList.add('loader-hide');  
    setTimeout(()=> loader.style.display='none', 360);  
  }  
  // Loader text helper (percent ‚Üí human text)  
  const loaderTextEl = document.getElementById('loader-text');  
  const updateProgress = (p) => {  
    if (!loaderTextEl) return;  
    if (p < 30) loaderTextEl.textContent = 'BootEX ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø ‡¶ö‡¶≤‡¶õ‡ßá‚Ä¶';  
    else if (p < 60) loaderTextEl.textContent = '‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';  
    else if (p < 90) loaderTextEl.textContent = '‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑‚Ä¶';  
    else loaderTextEl.textContent = '‡¶∞‡ßá‡¶°‡¶ø!';  
  };  
  startBrandLoader();  
  
  
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional  
  const firebaseConfig = {
  apiKey: "AIzaSyDMB0EdRB1NCVa2nsJmzb9gxSIZ5z-zVlI",
  authDomain: "max-money-2k07.firebaseapp.com",
  databaseURL: "https://max-money-2k07-default-rtdb.firebaseio.com",
  projectId: "max-money-2k07",
  storageBucket: "max-money-2k07.firebasestorage.app",
  messagingSenderId: "203429901779",
  appId: "1:203429901779:web:745f5a46e5ea16babceb26",
  measurementId: "G-3YGPYQEXFY"
};
  
  let appConfig = {}; let userState = {}; let tgUser = {}; let earningWalletBalance = 0;  
  let leaderboardData = { referral: [], earning: [] };  
  let userTransactions = [];  
  
  const popup = document.getElementById('popup');  
  const popupBody = document.getElementById('popup-body');  
  const showPopup = (content) => { popupBody.innerHTML = content; popup.style.display = 'flex'; };  
  const closePopup = () => { popup.style.display = 'none'; };  
  
  const loadAdSdk = (zoneId) => {  
    if (!zoneId) { console.error("Ad Zone ID is missing from Firebase config!"); return; }  
    if (document.querySelector(`script[data-zone='${zoneId}']`)) return;  
    const script = document.createElement('script');  
    script.src = `//libtl.com/sdk.js`;  
    script.setAttribute('data-zone', zoneId);  
    script.setAttribute('data-sdk', `show_${zoneId}`);  
    script.async = true;  
    document.body.appendChild(script);  
  };  

  
  function attachSupportLinks() {
    const tgBtn   = document.getElementById('btn-support-tg');
    const mailBtn = document.getElementById('btn-support-mail');
    if (!tgBtn || !mailBtn) return;

    const support = (appConfig && appConfig.support) ? appConfig.support : {};
    const tgUrl   = (support.telegramUrl || '').trim();
    const email   = (support.email || '').trim();

    // Telegram button
    if (tgUrl) {
      tgBtn.disabled = false;
      tgBtn.onclick = () => {
        const url = tgUrl.startsWith('http') || tgUrl.startsWith('tg:')
          ? tgUrl
          : `https://t.me/${tgUrl.replace('@','')}`;
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(url);
        } else {
          window.open(url, '_blank');
        }
      };
      tgBtn.title = '';
    } else {
      tgBtn.disabled = true;
      tgBtn.title = '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ URL ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
      tgBtn.onclick = null;
    }

    if (email) {
      mailBtn.disabled = false;
      mailBtn.onclick = () => {
        const href = email.startsWith('mailto:') ? email : `mailto:${email}`;
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(href);
        } else {
          window.location.href = href;
        }
      };
      mailBtn.title = '';
    } else {
      mailBtn.disabled = true;
      mailBtn.title = '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
      mailBtn.onclick = null;
    }
  }
  

  const initApp = async () => {  
    tg.ready(); tg.expand();  
    document.body.className = `${tg.colorScheme}-theme`;  
    tgUser = tg.initDataUnsafe.user;  
    if (!tgUser || !tgUser.id) { tg.showAlert("‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§"); tg.close(); return; }  
  
    try {  
      updateProgress(10); firebase.initializeApp(firebaseConfig); const db = firebase.database();  
      updateProgress(20);  
  
      const configSnapshot = await db.ref('config').once('value');  
      appConfig = configSnapshot.val() || {};  
      updateProgress(40);  
  
      await loadUserData(db); // depends on appConfig  
      updateProgress(60);  
  
      const referralBoardPromise = db.ref('users').orderByChild('referrals').limitToLast(10).once('value');  
      const earningBoardPromise = db.ref('users').orderByChild('totalEarned').limitToLast(10).once('value');  
      const historyPromise = loadTransactionHistory(db);  
  
      const [referralBoardSnap, earningBoardSnap] = await Promise.all([referralBoardPromise, earningBoardPromise, historyPromise]);  
      updateProgress(80);  
  
      referralBoardSnap.forEach(child => { leaderboardData.referral.push(child.val()); });  
      earningBoardSnap.forEach(child => { leaderboardData.earning.push(child.val()); });  
      leaderboardData.referral.reverse(); leaderboardData.earning.reverse();  
      updateProgress(90);  
  
      loadAdSdk(appConfig.adZoneId);  
      earningWalletBalance = parseFloat(localStorage.getItem(`earningWallet_${tgUser.id}`) || '0');  
  
      renderUI(); setupNavigation(); setupEventListeners();  
      updateProgress(100);  
  
      setTimeout(() => {  
        stopBrandLoader();  
        document.getElementById('app').style.display = 'block';  
        if (appConfig.welcomeMessage && !userState.welcomed) {  
          showPopup(`<h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>${appConfig.welcomeMessage}</p><button class="popup-close-btn">‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®</button>`);  
          db.ref(`users/${tgUser.id}/welcomed`).set(true);  
        }  
      }, 300);  
    } catch (error) {  
      console.error("Initialization failed:", error);  
      tg.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");  
    }  
  };  
  
  const loadUserData = async (db) => {  
    const userRef = db.ref(`users/${tgUser.id}`);  
    const snapshot = await userRef.once('value');  
    let userData = snapshot.val();  
  
    if (!userData) {  
      const startParam = tg.initDataUnsafe.start_param;  
      const referralId = (startParam && !isNaN(startParam)) ? startParam : null;  
  
      userData = {  
        id: tgUser.id, firstName: tgUser.first_name || '', lastName: tgUser.last_name || '',  
        username: tgUser.username || '', photoUrl: tgUser.photo_url || '',  
        balance: 0, referrals: 0, referredBy: referralId, totalEarned: 0, lifetimeAdCount: 0,  
        lastAdWatchDate: '1970-01-01', dailyAdCount: 0, breakUntil: 0, completedTasks: {}, welcomed: false  
      };  
      await userRef.set(userData);  
  
      if (referralId && referralId != tgUser.id) {  
        const referrerRef = db.ref(`users/${referralId}`);  
        const bonusAmount = parseFloat(appConfig.referralBonus || 0);  
        if (bonusAmount > 0) {  
          await referrerRef.transaction(currentData => {  
            if (currentData) {  
              currentData.balance = (currentData.balance || 0) + bonusAmount;  
              currentData.referrals = (currentData.referrals || 0) + 1;  
            }  
            return currentData;  
          });  
        } else {  
          await referrerRef.child('referrals').set(firebase.database.ServerValue.increment(1));  
        }  
      }  
    }  
  
    const today = new Date().toISOString().slice(0, 10);  
    if (userData.lastAdWatchDate !== today) {  
      userData.dailyAdCount = 0; userData.lastAdWatchDate = today;  
      await userRef.update({ dailyAdCount: 0, lastAdWatchDate: today });  
    }  
    userState = userData;  
  };  
  
  const loadTransactionHistory = async (db) => {  
    userTransactions = [];  
    const statuses = ['pending', 'completed', 'rejected'];  
    const historyPromises = statuses.map(status => db.ref(`withdrawals/${status}`).orderByChild('userId').equalTo(tgUser.id).once('value'));  
    const snapshots = await Promise.all(historyPromises);  
    snapshots.forEach(snap => { snap.forEach(childSnap => { userTransactions.push(childSnap.val()); }); });  
    userTransactions.sort((a, b) => b.timestamp - a.timestamp);  
  };  
  
  const renderUI = () => {  
    document.getElementById('user-photo').src = userState.photoUrl || 'https://via.placeholder.com/80';  
    document.getElementById('user-name').textContent = `${userState.firstName} ${userState.lastName}`;  
    document.getElementById('user-balance').textContent = (userState.balance || 0).toFixed(2);  
    document.getElementById('daily-ads-watched').textContent = `${userState.dailyAdCount || 0} / ${appConfig.dailyAdLimit || 0}`;  
    document.getElementById('referral-count').textContent = userState.referrals || 0;  
    document.getElementById('total-ads-watched').textContent = userState.lifetimeAdCount || 0;  
    document.getElementById('total-earned').textContent = (userState.totalEarned || 0).toFixed(2);  
    document.getElementById('earning-wallet-balance').textContent = earningWalletBalance.toFixed(2);  
    document.getElementById('move-to-balance-btn').disabled = earningWalletBalance < 100;  
  
    renderAdTask();  
    renderAdProgress();  
    renderDynamicTasks();  
    renderReferralSection();  
    renderWithdrawSection();  
    renderEarningsGraph();  
    renderDynamicLinks();

    
    attachSupportLinks();
  };  
  
  const renderAdProgress = () => {  
    const container = document.getElementById('ad-progress-container');  
    const dailyLimit = appConfig.dailyAdLimit || 1;  
    const watchedCount = userState.dailyAdCount || 0;  
    const percentage = (watchedCount / dailyLimit) * 100;  
    container.innerHTML = `  
      <div class="progress-info">  
        <span>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>  
        <span>${watchedCount} / ${dailyLimit}</span>  
      </div>  
      <div class="progress-bar-bg"><div class="progress-bar-fg" style="width: ${percentage}%;"></div></div>`;  
  };  
  
  const renderEarningsGraph = async () => {  
    const chartEl = document.getElementById('earnings-chart');  
    const labelsEl = document.getElementById('earnings-chart-labels');  
    chartEl.innerHTML = ''; labelsEl.innerHTML = '';  
    const today = new Date(); const dates = [];  
    for (let i = 6; i >= 0; i--) { const date = new Date(today); date.setDate(today.getDate() - i); dates.push(date.toISOString().slice(0, 10)); }  
    const earningsPromises = dates.map(date => firebase.database().ref(`userEarnings/${tgUser.id}/${date}`).once('value'));  
    const snapshots = await Promise.all(earningsPromises);  
    const earningsData = snapshots.map(snap => snap.val() || 0);  
    const maxEarning = Math.max(...earningsData, 1);  
    earningsData.forEach((earning, index) => {  
      const height = (earning / maxEarning) * 100;  
      const dateLabel = new Date(dates[index]).toLocaleDateString('bn-BD', { day: 'numeric' });  
      chartEl.innerHTML += `<div class="bar" style="height: ${height}%;"><span class="tooltip">${earning.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</span></div>`;  
      labelsEl.innerHTML += `<span>${dateLabel}</span>`;  
    });  
  };  
  
  const handleWatchAd = async () => {  
    if (userState.dailyAdCount >= appConfig.dailyAdLimit) { tg.showAlert("‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§"); return; }  
    const now = Date.now();  
    if (userState.breakUntil && now < userState.breakUntil) {  
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);  
      tg.showAlert(`‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ${remaining} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`); return;  
    }  
  
    const adFunction = window['show_' + appConfig.adZoneId];  
    if (typeof adFunction !== 'function') {  
      tg.showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶®‡¶Ø‡¶º‡•§ ‡¶ï‡¶Ø‡¶º‡ßá‡¶ï ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); return; }  
  
    showPopup(`<div class="popup-loader"><div class="spinner"></div></div><h2>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá</h2><p>‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶</p>`);  
  
    try {  
      await adFunction();  
      closePopup();  
      const adValue = appConfig.adValue || 0;  
  
      earningWalletBalance += adValue;  
      localStorage.setItem(`earningWallet_${tgUser.id}`, earningWalletBalance.toString());  
  
      userState.dailyAdCount++;  
      userState.lifetimeAdCount++;  
      userState.totalEarned = (userState.totalEarned || 0) + adValue;  
  
      const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);  
      const updates = {};  
      updates.dailyAdCount = userState.dailyAdCount;  
      updates.lifetimeAdCount = userState.lifetimeAdCount;  
      updates.totalEarned = userState.totalEarned;  
      if ((userState.dailyAdCount) % appConfig.adsPerBreak === 0 && appConfig.adsPerBreak > 0) {  
        updates.breakUntil = Date.now() + (appConfig.breakDuration * 60000);  
        userState.breakUntil = updates.breakUntil;  
      }  
      await userRef.update(updates);  
  
      const today = new Date().toISOString().slice(0, 10);  
      await db.ref(`userEarnings/${tgUser.id}/${today}`).set(firebase.database.ServerValue.increment(adValue));  
  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert(`+${adValue.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);  
  
      renderUI();  
  
    } catch (error) {  
      console.error("Ad failed to load:", error);  
      closePopup();  
      tg.showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");  
    }  
  };  
  
  const handleMoveToBalance = async () => {  
    if(earningWalletBalance < 100) { tg.showAlert("‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§"); return; }  
    const btn = document.getElementById('move-to-balance-btn'); btn.disabled = true; btn.textContent = '‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';  
    try {  
      const db = firebase.database();  
      await db.ref(`users/${tgUser.id}/balance`).set(firebase.database.ServerValue.increment(earningWalletBalance));  
      userState.balance += earningWalletBalance;  
      earningWalletBalance = 0;  
      localStorage.setItem(`earningWallet_${tgUser.id}`, '0');  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");  
    } catch(error) {  
      console.error("Failed to move balance:", error);  
      tg.showAlert("‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");  
    } finally { btn.textContent = '‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶®'; renderUI(); }  
  };  
  
  const renderWithdrawalHistory = () => {  
    const listEl = document.getElementById('withdrawal-history-list');  
    if (userTransactions.length === 0) { listEl.innerHTML = '<p>‡¶ï‡ßã‡¶®‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>'; return; }  
    listEl.innerHTML = userTransactions.map(item => `  
      <div class="history-item">  
        <div class="history-details">  
          <p>${item.amount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ - ${item.method}</p>  
          <small>${new Date(item.timestamp).toLocaleString('bn-BD')}</small>  
        </div>  
        <span class="history-status status-${item.status}">${item.status}</span>  
      </div>`).join('');  
  };  
  
  const setupNavigation = () => {  
    const navButtons = document.querySelectorAll('.nav-btn'); const pages = document.querySelectorAll('.page');  
    navButtons.forEach(button => {  
      button.addEventListener('click', () => {  
        const pageId = button.dataset.page;  
        pages.forEach(page => page.classList.remove('active'));  
        document.getElementById(pageId).classList.add('active');  
        navButtons.forEach(btn => btn.classList.remove('active'));  
        button.classList.add('active');  
        if (pageId === 'profile-page') { renderWithdrawalHistory(); }  
        if (pageId === 'leaderboard-page') { renderLeaderboard(); }  
      });  
    });  
  };  
  
  const setupEventListeners = () => {  
    popup.addEventListener('click', (e) => { if (e.target.classList.contains('popup-close-btn') || e.target.id === 'popup') closePopup(); });  
    document.querySelector('.leaderboard-toggle').addEventListener('click', (e) => {  
      if(e.target.classList.contains('toggle-btn')) {  
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));  
        e.target.classList.add('active');  
        renderLeaderboard();  
      }  
    });  
    document.getElementById('dynamic-tasks-container').addEventListener('click', (e) => handleClaimTask(e));  
    document.getElementById('profile-page').addEventListener('submit', (e) => handleWithdraw(e));  
    document.getElementById('referral-section').addEventListener('click', (e) => { if(e.target.id === 'copy-ref-link-btn') copyReferralLink(); });  
    document.getElementById('move-to-balance-btn').addEventListener('click', handleMoveToBalance);  
  };  
  
  const renderAdTask = () => {  
    const container = document.getElementById('ad-task-container');  
    const now = Date.now();  
    const onBreak = userState.breakUntil && now < userState.breakUntil;  
    const limitReached = userState.dailyAdCount >= appConfig.dailyAdLimit;  
    let html = '';  
    if (onBreak) {  
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/hourglass.png" alt="icon">  
        <div class="task-info"><h3>‡¶¨‡¶ø‡¶∞‡¶§‡¶ø ‡¶ö‡¶≤‡¶õ‡ßá</h3><p>‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ${remaining} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div>  
        <button class="action-btn" disabled>‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶®</button>  
      </div>`;  
    } else if (limitReached) {  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/stop-circled.png" alt="icon">  
        <div class="task-info"><h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£</h3><p>‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div>  
        <button class="action-btn" disabled>‡¶∏‡ßÄ‡¶Æ‡¶æ</button>  
      </div>`;  
    } else {  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/play-button-circled.png" alt="icon">  
        <div class="task-info"><h3>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h3><p>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶®: ${appConfig.adValue || 0} ‡¶ü‡¶æ‡¶ï‡¶æ</p></div>  
        <button id="watch-ad-btn" class="action-btn">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>  
      </div>`;  
    }  
    container.innerHTML = html;  
    if (!onBreak && !limitReached) { document.getElementById('watch-ad-btn').addEventListener('click', handleWatchAd); }  
  };  
  
  const handleClaimTask = async (e) => {  
    if (e.target.classList.contains('action-btn') && e.target.dataset.taskId) {  
      const taskId = e.target.dataset.taskId;  
      const task = appConfig.tasks[taskId];  
      if (!task || (userState.completedTasks && userState.completedTasks[taskId])) { tg.showAlert('‡¶è‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§'); return; }  
      tg.openLink(e.target.dataset.taskUrl);  
      e.target.disabled = true; e.target.textContent = '‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';  
      setTimeout(async () => {  
        try {  
          const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);  
          await userRef.child(`completedTasks/${taskId}`).set(true);  
          await userRef.child('balance').set(firebase.database.ServerValue.increment(task.reward));  
          userState.balance += task.reward;  
          if (!userState.completedTasks) userState.completedTasks = {};  
          userState.completedTasks[taskId] = true;  
          tg.HapticFeedback.notificationOccurred('success');  
          tg.showAlert(`‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶ø ${task.reward} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§`);  
          renderUI();  
        } catch (error) {  
          tg.showAlert('‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');  
          e.target.disabled = false; e.target.textContent = '‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®';  
        }  
      }, 5000);  
    }  
  };  
  
  const handleWithdraw = async (e) => {  
    if(e.target.id !== 'withdraw-form') return;  
    e.preventDefault();  
  
    const minRefsRequired = appConfig.minimumWithdrawReferrals || 0;  
    const userReferrals = userState.referrals || 0;  
    if (minRefsRequired > 0 && userReferrals < minRefsRequired) {  
      tg.showAlert(`‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ${minRefsRequired} ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ${userReferrals} ‡¶ú‡¶®‡•§`);  
      return;  
    }  
  
    const methodEl = document.getElementById('withdraw-method');  
    const accountNumber = document.getElementById('account-number').value;  
    const amount = parseFloat(document.getElementById('amount').value);  
    const selectedMethod = appConfig.withdrawMethods.find(m => m.name === methodEl.value);  
  
    if (isNaN(amount) || amount <= 0) { tg.showAlert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§"); return; }  
    if (!selectedMethod) { tg.showAlert("‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡•§"); return; }  
    if (amount < selectedMethod.min) { tg.showAlert(`${selectedMethod.name} ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡¶§‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ${selectedMethod.min} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§`); return; }  
    if (amount > userState.balance) { tg.showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§"); return; }  
  
    const btn = document.getElementById('withdraw-submit-btn'); btn.disabled = true; btn.textContent = '‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';  
    const db = firebase.database();  
    try {  
      const userRef = db.ref(`users/${tgUser.id}`);  
      userState.balance -= amount;  
      renderUI();  
  
      await userRef.child('balance').set(firebase.database.ServerValue.increment(-amount));  
      const reqId = db.ref('withdrawals/pending').push().key;  
      const newRequest = {  
        id: reqId, userId: tgUser.id, userName: `${userState.firstName} ${userState.lastName}`,  
        method: selectedMethod.name, account: accountNumber, amount: amount,  
        status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP  
      };  
      await db.ref(`withdrawals/pending/${reqId}`).set(newRequest);  
  
      userTransactions.unshift(newRequest);  
      renderWithdrawalHistory();  
  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");  
      document.getElementById('withdraw-form').reset();  
    } catch (error) {  
      userState.balance += amount;  
      tg.HapticFeedback.notificationOccurred('error');  
      tg.showAlert("‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");  
    } finally {  
      renderUI();  
      btn.disabled = false;  
      btn.textContent = '‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®';  
    }  
  };  
  
  const copyReferralLink = () => {  
    const refLinkInput = document.getElementById('referral-link');  
    refLinkInput.select();  
    refLinkInput.setSelectionRange(0, 99999);  
    try {  
      navigator.clipboard.writeText(refLinkInput.value).then(() => {  
        tg.HapticFeedback.notificationOccurred('success');  
        tg.showAlert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");  
      });  
    } catch (err) {  
      document.execCommand('copy');  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");  
    }  
  };  
  
  const renderLeaderboard = () => {  
    const activeBoard = document.querySelector('.toggle-btn.active').dataset.board;  
    const listEl = document.getElementById(activeBoard === 'referral' ? 'referral-leaderboard-list' : 'earning-leaderboard-list');  
    const data = leaderboardData[activeBoard];  
    document.getElementById('referral-board').style.display = activeBoard === 'referral' ? 'block' : 'none';  
    document.getElementById('earning-board').style.display = activeBoard === 'earning' ? 'block' : 'none';  
    listEl.innerHTML = '';  
    if (data.length === 0) { listEl.innerHTML = '<li>‡¶ï‡ßã‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á‡•§</li>'; return; }  
    data.forEach((user, index) => {  
      const score = activeBoard === 'referral' ? (user.referrals || 0) : (user.totalEarned || 0).toFixed(2);  
      const item = document.createElement('li'); item.className = 'leaderboard-item';  
      item.innerHTML = `  
        <span class="rank" style="width:36px;text-align:center;font-weight:800;color:var(--primary-color);font-size:1rem;">üèÖ #${index + 1}</span>  
        <img src="${user.photoUrl || 'https://via.placeholder.com/50'}" alt="User" style="width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,0.2);margin-right:10px;">  
        <span class="leaderboard-name" style="flex-grow:1;font-weight:600;font-size:0.95rem;">${user.firstName}</span>  
        <span class="leaderboard-score" style="font-weight:700;color:var(--secondary-color);font-size:1rem;">${score}</span>`;  
      listEl.appendChild(item);  
    });  
  };  
  
  const renderDynamicTasks = () => {  
    const container = document.getElementById('dynamic-tasks-container'); container.innerHTML = '';  
    if (appConfig.tasks) {  
      const tasks = [];  
      for(const key in appConfig.tasks) { tasks.push({key, ...appConfig.tasks[key]}); }  
      tasks.reverse();  
      tasks.forEach(task => {  
        const isCompleted = userState.completedTasks && userState.completedTasks[task.key];  
        const el = document.createElement('div'); el.className = 'task-container';  
        el.innerHTML = `  
          <img class="task-icon-img" src="${task.icon}" alt="icon"  
               style="width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(0,0,0,0.08);">  
          <div class="task-info" style="flex-grow:1;">  
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:5px;color:var(--primary-color);">${task.name}</h3>  
            <p style="font-size:0.9rem;opacity:0.85;">üéÅ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® <b>${task.reward} ‡¶ü‡¶æ‡¶ï‡¶æ</b> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>  
          </div>  
          <button class="action-btn" data-task-id="${task.key}" data-task-url="${task.url}" ${isCompleted ? 'disabled' : ''}  
                  style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">  
            ${isCompleted ? '‚úÖ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : 'üéØ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®'}  
          </button>`;  
        container.appendChild(el);  
      });  
    }  
  };  
  
  const renderReferralSection = () => {  
    const container = document.getElementById('referral-section');  
    const refLink = `https://t.me/${appConfig.botUsername}/app?startapp=${tgUser.id}`;  
    container.innerHTML = `  
      <div class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06); border: 1px solid var(--border-light);">  
        <h3 style="margin-bottom: 8px; color: var(--primary-color); font-weight: 700; font-size: 1.1rem;">ü§ù ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</h3>  
        <p style="font-size: 0.95rem; margin-bottom: 14px; opacity: 0.85;">  
          ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá <b>${appConfig.referralBonus || 0} ‡¶ü‡¶æ‡¶ï‡¶æ</b> ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§  
        </p>  
        <div style="display:flex; flex-direction:column; gap:10px;">  
          <input type="text" id="referral-link" value="${refLink}" readonly  
                 style="padding:12px; text-align:center; border-radius:10px; border:1px dashed var(--primary-color); background:rgba(231,76,60,0.05); font-size:0.92rem; font-weight:600;">  
          <button id="copy-ref-link-btn" class="action-btn" style="width:100%; border-radius:10px; font-weight:700; font-size:0.95rem;">  
            üîó ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®  
          </button>  
        </div>  
        <small style="margin-top:10px; opacity:0.75; text-align:center; font-size:0.85rem;">üì¢ ‡¶ü‡¶ø‡¶™‡¶∏: ‡¶¨‡ßá‡¶∂‡¶ø ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶¨‡ßá‡¶∂‡¶ø ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®!</small>  
      </div>`;  
  };  
  
  const renderWithdrawSection = () => {  
    const container = document.getElementById('withdraw-section'); let optionsHtml = '';  
    if (appConfig.withdrawMethods) {  
      appConfig.withdrawMethods.forEach(method => { optionsHtml += `<option value="${method.name}">${method.name} (‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ${method.min} ‡¶ü‡¶æ‡¶ï‡¶æ)</option>`; });  
    }  
  
    const minRefs = appConfig.minimumWithdrawReferrals || 0;  
    let referralNotice = '';  
    if (minRefs > 0) {  
      referralNotice = `<p style="font-size: 0.85rem; text-align: center; margin-bottom: 15px; opacity: 0.8;"><b>‡¶®‡ßã‡¶ü:</b> ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶§‡¶§ <b>${minRefs}</b> ‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</p>`;  
    }  
  
    container.innerHTML = `  
      <form id="withdraw-form" class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">  
        <h3 style="margin-bottom: 12px; color: var(--primary-color); font-weight: 700;">üí∏ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß</h3>  
        ${referralNotice}  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="withdraw-method" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label>  
          <select id="withdraw-method" required style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); background:rgba(255,255,255,0.95); font-size:0.95rem;">${optionsHtml}</select>  
        </div>  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="account-number" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ / ‡¶Ü‡¶á‡¶°‡¶ø</label>  
          <input type="text" id="account-number" required placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: 01XXXXXXXXX" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">  
        </div>  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="amount" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ü‡¶æ‡¶ï‡¶æ)</label>  
          <input type="number" step="any" id="amount" required placeholder="‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">  
        </div>  
        <button type="submit" id="withdraw-submit-btn" class="action-btn" style="width:100%; margin-top:6px; border-radius:10px; font-weight:700; font-size:1rem;">‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>  
        <p style="font-size:0.85rem; text-align:center; margin-top:15px; opacity:0.8;">  
          <b>‡¶®‡ßã‡¶ü:</b> ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶¨‡ßá‡•§  
        </p>  
      </form>`;  
  };  
  
  const renderDynamicLinks = () => {  
    const container = document.getElementById('dynamic-links-container'); container.innerHTML = '';  
    if (appConfig.links) {  
      const links = [];  
      for (const key in appConfig.links) { links.push({key, ...appConfig.links[key]}); }  
      links.reverse();  
      links.forEach(link => {  
        const el = document.createElement('div'); el.className = 'task-container';  
        el.innerHTML = `  
          <img class="task-icon-img" src="${link.icon}" alt="icon" style="width:48px;height:48px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 6px rgba(0,0,0,0.08);">  
          <div class="task-info" style="flex-grow:1;">  
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:4px;color:var(--primary-color);">${link.name}</h3>  
            <p style="font-size:0.9rem;opacity:0.8;">‡¶Ü‡¶∞‡¶ì ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶¨‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßç‡¶≤‡ßã‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>  
          </div>  
          <button class="action-btn" onclick="window.Telegram.WebApp.openLink('${link.url}')" style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">üåê ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</button>`;  
        container.appendChild(el);  
      });  
    }  
  };  
  
  initApp();  
});  
</script> 
<!-- <script>
// -----------------------------
// data-page ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
// -----------------------------
document.querySelectorAll('[data-page]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const target = btn.getAttribute('data-page');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(target).classList.add('active');
  });
});

document.addEventListener('DOMContentLoaded', () => {
  const tg = window.Telegram.WebApp;

  /* ---------- NEW: Brand Loader Controller ---------- */
  let lottiePlayer = null;
  function startBrandLoader() {
    const box = document.getElementById('lottie-box');
    const fb  = document.getElementById('fallback-bounce');
    try {
      lottiePlayer = lottie.loadAnimation({
        container: box,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        // üëâ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶≤‡ßã‡¶ü‡¶ø JSON ‡¶¶‡¶ø‡¶®
        path: 'https://assets9.lottiefiles.com/packages/lf20_j1adxtyb.json'
      });
      fb.style.display = 'none';
    } catch(e) {
      fb.style.display = 'flex'; // fallback bounce
    }
  }
  function stopBrandLoader() {
    try { lottiePlayer && lottiePlayer.destroy && lottiePlayer.destroy(); } catch(e){}
    const loader = document.getElementById('app-loader');
    loader.classList.add('loader-hide');
    setTimeout(()=> loader.style.display='none', 360);
  }
  // Loader text helper (percent ‚Üí human text)
  const loaderTextEl = document.getElementById('loader-text');
  const updateProgress = (p) => {
    if (!loaderTextEl) return;
    if (p < 30) loaderTextEl.textContent = 'BootEX ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡¶ø ‡¶ö‡¶≤‡¶õ‡ßá‚Ä¶';
    else if (p < 60) loaderTextEl.textContent = '‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';
    else if (p < 90) loaderTextEl.textContent = '‡¶™‡ßç‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∂‡ßá‡¶∑‚Ä¶';
    else loaderTextEl.textContent = '‡¶∞‡ßá‡¶°‡¶ø!';
  };
  startBrandLoader();
  /* ---------- /NEW ---------- */

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBqtUdglrrNNf68-UEHSSvkSCnLy2SNFgo",
    authDomain: "botbit-a30f3.firebaseapp.com",
    databaseURL: "https://botbit-a30f3-default-rtdb.firebaseio.com",
    projectId: "botbit-a30f3",
    storageBucket: "botbit-a30f3.firebasestorage.app",
    messagingSenderId: "662684170149",
    appId: "1:662684170149:web:4d3a2222d28024b3f51a4c",
    measurementId: "G-V03WQ1FBT8"
  };

  let appConfig = {}; let userState = {}; let tgUser = {}; let earningWalletBalance = 0;
  let leaderboardData = { referral: [], earning: [] };
  let userTransactions = [];

  const popup = document.getElementById('popup');
  const popupBody = document.getElementById('popup-body');
  const showPopup = (content) => { popupBody.innerHTML = content; popup.style.display = 'flex'; };
  const closePopup = () => { popup.style.display = 'none'; };

  const loadAdSdk = (zoneId) => {
    if (!zoneId) { console.error("Ad Zone ID is missing from Firebase config!"); return; }
    if (document.querySelector(`script[data-zone='${zoneId}']`)) return;
    const script = document.createElement('script');
    script.src = `//libtl.com/sdk.js`;
    script.setAttribute('data-zone', zoneId);
    script.setAttribute('data-sdk', `show_${zoneId}`);
    script.async = true;
    document.body.appendChild(script);
  };

  const initApp = async () => {
    tg.ready(); tg.expand();
    document.body.className = `${tg.colorScheme}-theme`;
    tgUser = tg.initDataUnsafe.user;
    if (!tgUser || !tgUser.id) { tg.showAlert("‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§"); tg.close(); return; }

    try {
      updateProgress(10); firebase.initializeApp(firebaseConfig); const db = firebase.database();
      updateProgress(20);

      const configSnapshot = await db.ref('config').once('value');
      appConfig = configSnapshot.val() || {};
      updateProgress(40);

      await loadUserData(db); // depends on appConfig
      updateProgress(60);

      const referralBoardPromise = db.ref('users').orderByChild('referrals').limitToLast(10).once('value');
      const earningBoardPromise = db.ref('users').orderByChild('totalEarned').limitToLast(10).once('value');
      const historyPromise = loadTransactionHistory(db);

      const [referralBoardSnap, earningBoardSnap] = await Promise.all([referralBoardPromise, earningBoardPromise, historyPromise]);
      updateProgress(80);

      referralBoardSnap.forEach(child => { leaderboardData.referral.push(child.val()); });
      earningBoardSnap.forEach(child => { leaderboardData.earning.push(child.val()); });
      leaderboardData.referral.reverse(); leaderboardData.earning.reverse();
      updateProgress(90);

      loadAdSdk(appConfig.adZoneId);
      earningWalletBalance = parseFloat(localStorage.getItem(`earningWallet_${tgUser.id}`) || '0');

      renderUI(); setupNavigation(); setupEventListeners();
      updateProgress(100);

      setTimeout(() => {
        stopBrandLoader();
        document.getElementById('app').style.display = 'block';
        if (appConfig.welcomeMessage && !userState.welcomed) {
          showPopup(`<h2>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2><p>${appConfig.welcomeMessage}</p><button class="popup-close-btn">‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶®</button>`);
          db.ref(`users/${tgUser.id}/welcomed`).set(true);
        }
      }, 300);
    } catch (error) {
      console.error("Initialization failed:", error);
      tg.showAlert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    }
  };

  const loadUserData = async (db) => {
    const userRef = db.ref(`users/${tgUser.id}`);
    const snapshot = await userRef.once('value');
    let userData = snapshot.val();

    if (!userData) {
      const startParam = tg.initDataUnsafe.start_param;
      const referralId = (startParam && !isNaN(startParam)) ? startParam : null;

      userData = {
        id: tgUser.id, firstName: tgUser.first_name || '', lastName: tgUser.last_name || '',
        username: tgUser.username || '', photoUrl: tgUser.photo_url || '',
        balance: 0, referrals: 0, referredBy: referralId, totalEarned: 0, lifetimeAdCount: 0,
        lastAdWatchDate: '1970-01-01', dailyAdCount: 0, breakUntil: 0, completedTasks: {}, welcomed: false
      };
      await userRef.set(userData);

      if (referralId && referralId != tgUser.id) {
        const referrerRef = db.ref(`users/${referralId}`);
        const bonusAmount = parseFloat(appConfig.referralBonus || 0);
        if (bonusAmount > 0) {
          await referrerRef.transaction(currentData => {
            if (currentData) {
              currentData.balance = (currentData.balance || 0) + bonusAmount;
              currentData.referrals = (currentData.referrals || 0) + 1;
            }
            return currentData;
          });
        } else {
          await referrerRef.child('referrals').set(firebase.database.ServerValue.increment(1));
        }
      }
    }

    const today = new Date().toISOString().slice(0, 10);
    if (userData.lastAdWatchDate !== today) {
      userData.dailyAdCount = 0; userData.lastAdWatchDate = today;
      await userRef.update({ dailyAdCount: 0, lastAdWatchDate: today });
    }
    userState = userData;
  };

  const loadTransactionHistory = async (db) => {
    userTransactions = [];
    const statuses = ['pending', 'completed', 'rejected'];
    const historyPromises = statuses.map(status => db.ref(`withdrawals/${status}`).orderByChild('userId').equalTo(tgUser.id).once('value'));
    const snapshots = await Promise.all(historyPromises);
    snapshots.forEach(snap => { snap.forEach(childSnap => { userTransactions.push(childSnap.val()); }); });
    userTransactions.sort((a, b) => b.timestamp - a.timestamp);
  };

  const renderUI = () => {
    document.getElementById('user-photo').src = userState.photoUrl || 'https://via.placeholder.com/80';
    document.getElementById('user-name').textContent = `${userState.firstName} ${userState.lastName}`;
    document.getElementById('user-balance').textContent = (userState.balance || 0).toFixed(2);
    document.getElementById('daily-ads-watched').textContent = `${userState.dailyAdCount || 0} / ${appConfig.dailyAdLimit || 0}`;
    document.getElementById('referral-count').textContent = userState.referrals || 0;
    document.getElementById('total-ads-watched').textContent = userState.lifetimeAdCount || 0;
    document.getElementById('total-earned').textContent = (userState.totalEarned || 0).toFixed(2);
    document.getElementById('earning-wallet-balance').textContent = earningWalletBalance.toFixed(2);
    document.getElementById('move-to-balance-btn').disabled = earningWalletBalance < 100;

    renderAdTask();
    renderAdProgress();
    renderDynamicTasks();
    renderReferralSection();
    renderWithdrawSection();
    renderEarningsGraph();
    renderDynamicLinks();
  };

  const renderAdProgress = () => {
    const container = document.getElementById('ad-progress-container');
    const dailyLimit = appConfig.dailyAdLimit || 1;
    const watchedCount = userState.dailyAdCount || 0;
    const percentage = (watchedCount / dailyLimit) * 100;
    container.innerHTML = `
      <div class="progress-info">
        <span>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>
        <span>${watchedCount} / ${dailyLimit}</span>
      </div>
      <div class="progress-bar-bg"><div class="progress-bar-fg" style="width: ${percentage}%;"></div></div>`;
  };

  const renderEarningsGraph = async () => {
    const chartEl = document.getElementById('earnings-chart');
    const labelsEl = document.getElementById('earnings-chart-labels');
    chartEl.innerHTML = ''; labelsEl.innerHTML = '';
    const today = new Date(); const dates = [];
    for (let i = 6; i >= 0; i--) { const date = new Date(today); date.setDate(today.getDate() - i); dates.push(date.toISOString().slice(0, 10)); }
    const earningsPromises = dates.map(date => firebase.database().ref(`userEarnings/${tgUser.id}/${date}`).once('value'));
    const snapshots = await Promise.all(earningsPromises);
    const earningsData = snapshots.map(snap => snap.val() || 0);
    const maxEarning = Math.max(...earningsData, 1);
    earningsData.forEach((earning, index) => {
      const height = (earning / maxEarning) * 100;
      const dateLabel = new Date(dates[index]).toLocaleDateString('bn-BD', { day: 'numeric' });
      chartEl.innerHTML += `<div class="bar" style="height: ${height}%;"><span class="tooltip">${earning.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ</span></div>`;
      labelsEl.innerHTML += `<span>${dateLabel}</span>`;
    });
  };

  const handleWatchAd = async () => {
    if (userState.dailyAdCount >= appConfig.dailyAdLimit) { tg.showAlert("‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§"); return; }
    const now = Date.now();
    if (userState.breakUntil && now < userState.breakUntil) {
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);
      tg.showAlert(`‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ${remaining} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`); return;
    }

    const adFunction = window['show_' + appConfig.adZoneId];
    if (typeof adFunction !== 'function') {
      tg.showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶®‡¶Ø‡¶º‡•§ ‡¶ï‡¶Ø‡¶º‡ßá‡¶ï ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); return;
    }

    showPopup(`<div class="popup-loader"><div class="spinner"></div></div><h2>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá</h2><p>‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‚Ä¶</p>`);

    try {
      await adFunction();
      closePopup();
      const adValue = appConfig.adValue || 0;

      earningWalletBalance += adValue;
      localStorage.setItem(`earningWallet_${tgUser.id}`, earningWalletBalance.toString());

      userState.dailyAdCount++;
      userState.lifetimeAdCount++;
      userState.totalEarned = (userState.totalEarned || 0) + adValue;

      const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);
      const updates = {};
      updates.dailyAdCount = userState.dailyAdCount;
      updates.lifetimeAdCount = userState.lifetimeAdCount;
      updates.totalEarned = userState.totalEarned;
      if ((userState.dailyAdCount) % appConfig.adsPerBreak === 0 && appConfig.adsPerBreak > 0) {
        updates.breakUntil = Date.now() + (appConfig.breakDuration * 60000);
        userState.breakUntil = updates.breakUntil;
      }
      await userRef.update(updates);

      const today = new Date().toISOString().slice(0, 10);
      await db.ref(`userEarnings/${tgUser.id}/${today}`).set(firebase.database.ServerValue.increment(adValue));

      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert(`+${adValue.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);

      renderUI();

    } catch (error) {
      console.error("Ad failed to load:", error);
      closePopup();
      tg.showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    }
  };

  const handleMoveToBalance = async () => {
    if(earningWalletBalance < 100) { tg.showAlert("‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§"); return; }
    const btn = document.getElementById('move-to-balance-btn'); btn.disabled = true; btn.textContent = '‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';
    try {
      const db = firebase.database();
      await db.ref(`users/${tgUser.id}/balance`).set(firebase.database.ServerValue.increment(earningWalletBalance));
      userState.balance += earningWalletBalance;
      earningWalletBalance = 0;
      localStorage.setItem(`earningWallet_${tgUser.id}`, '0');
      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
    } catch(error) {
      console.error("Failed to move balance:", error);
      tg.showAlert("‡¶∏‡ßç‡¶•‡¶æ‡¶®‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
    } finally { btn.textContent = '‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶®‡¶ø‡¶®'; renderUI(); }
  };

  const renderWithdrawalHistory = () => {
    const listEl = document.getElementById('withdrawal-history-list');
    if (userTransactions.length === 0) { listEl.innerHTML = '<p>‡¶ï‡ßã‡¶®‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>'; return; }
    listEl.innerHTML = userTransactions.map(item => `
      <div class="history-item">
        <div class="history-details">
          <p>${item.amount.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ - ${item.method}</p>
          <small>${new Date(item.timestamp).toLocaleString('bn-BD')}</small>
        </div>
        <span class="history-status status-${item.status}">${item.status}</span>
      </div>`).join('');
  };

  const setupNavigation = () => {
    const navButtons = document.querySelectorAll('.nav-btn'); const pages = document.querySelectorAll('.page');
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const pageId = button.dataset.page;
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        navButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        if (pageId === 'profile-page') { renderWithdrawalHistory(); }
        if (pageId === 'leaderboard-page') { renderLeaderboard(); }
      });
    });
  };

  const setupEventListeners = () => {
    popup.addEventListener('click', (e) => { if (e.target.classList.contains('popup-close-btn') || e.target.id === 'popup') closePopup(); });
    document.querySelector('.leaderboard-toggle').addEventListener('click', (e) => {
      if(e.target.classList.contains('toggle-btn')) {
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        renderLeaderboard();
      }
    });
    document.getElementById('dynamic-tasks-container').addEventListener('click', (e) => handleClaimTask(e));
    document.getElementById('profile-page').addEventListener('submit', (e) => handleWithdraw(e));
    document.getElementById('referral-section').addEventListener('click', (e) => { if(e.target.id === 'copy-ref-link-btn') copyReferralLink(); });
    document.getElementById('move-to-balance-btn').addEventListener('click', handleMoveToBalance);
  };

  const renderAdTask = () => {
    const container = document.getElementById('ad-task-container');
    const now = Date.now();
    const onBreak = userState.breakUntil && now < userState.breakUntil;
    const limitReached = userState.dailyAdCount >= appConfig.dailyAdLimit;
    let html = '';
    if (onBreak) {
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/hourglass.png" alt="icon">
        <div class="task-info"><h3>‡¶¨‡¶ø‡¶∞‡¶§‡¶ø ‡¶ö‡¶≤‡¶õ‡ßá</h3><p>‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶∞‡¶ì ${remaining} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div>
        <button class="action-btn" disabled>‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ‡¶®</button>
      </div>`;
    } else if (limitReached) {
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/stop-circled.png" alt="icon">
        <div class="task-info"><h3>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£</h3><p>‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p></div>
        <button class="action-btn" disabled>‡¶∏‡ßÄ‡¶Æ‡¶æ</button>
      </div>`;
    } else {
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/play-button-circled.png" alt="icon">
        <div class="task-info"><h3>‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h3><p>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶®: ${appConfig.adValue || 0} ‡¶ü‡¶æ‡¶ï‡¶æ</p></div>
        <button id="watch-ad-btn" class="action-btn">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
      </div>`;
    }
    container.innerHTML = html;
    if (!onBreak && !limitReached) { document.getElementById('watch-ad-btn').addEventListener('click', handleWatchAd); }
  };

  const handleClaimTask = async (e) => {
    if (e.target.classList.contains('action-btn') && e.target.dataset.taskId) {
      const taskId = e.target.dataset.taskId;
      const task = appConfig.tasks[taskId];
      if (!task || (userState.completedTasks && userState.completedTasks[taskId])) { tg.showAlert('‡¶è‡¶á ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§'); return; }
      tg.openLink(e.target.dataset.taskUrl);
      e.target.disabled = true; e.target.textContent = '‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';
      setTimeout(async () => {
        try {
          const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);
          await userRef.child(`completedTasks/${taskId}`).set(true);
          await userRef.child('balance').set(firebase.database.ServerValue.increment(task.reward));
          userState.balance += task.reward;
          if (!userState.completedTasks) userState.completedTasks = {};
          userState.completedTasks[taskId] = true;
          tg.HapticFeedback.notificationOccurred('success');
          tg.showAlert(`‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶ø ${task.reward} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§`);
          renderUI();
        } catch (error) {
          tg.showAlert('‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
          e.target.disabled = false; e.target.textContent = '‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ï‡ßç‡¶≤‡ßá‡¶á‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
      }, 5000);
    }
  };

  const handleWithdraw = async (e) => {
    if(e.target.id !== 'withdraw-form') return;
    e.preventDefault();

    const minRefsRequired = appConfig.minimumWithdrawReferrals || 0;
    const userReferrals = userState.referrals || 0;
    if (minRefsRequired > 0 && userReferrals < minRefsRequired) {
      tg.showAlert(`‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ${minRefsRequired} ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡¶æ‡¶≤ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ${userReferrals} ‡¶ú‡¶®‡•§`);
      return;
    }

    const methodEl = document.getElementById('withdraw-method');
    const accountNumber = document.getElementById('account-number').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const selectedMethod = appConfig.withdrawMethods.find(m => m.name === methodEl.value);

    if (isNaN(amount) || amount <= 0) { tg.showAlert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§"); return; }
    if (!selectedMethod) { tg.showAlert("‡¶≠‡ßÅ‡¶≤ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡•§"); return; }
    if (amount < selectedMethod.min) { tg.showAlert(`${selectedMethod.name} ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡¶§‡ßá ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ${selectedMethod.min} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§`); return; }
    if (amount > userState.balance) { tg.showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ø‡¶•‡ßá‡¶∑‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§"); return; }

    const btn = document.getElementById('withdraw-submit-btn'); btn.disabled = true; btn.textContent = '‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‚Ä¶';
    const db = firebase.database();
    try {
      const userRef = db.ref(`users/${tgUser.id}`);
      userState.balance -= amount;
      renderUI();

      await userRef.child('balance').set(firebase.database.ServerValue.increment(-amount));
      const reqId = db.ref('withdrawals/pending').push().key;
      const newRequest = {
        id: reqId, userId: tgUser.id, userName: `${userState.firstName} ${userState.lastName}`,
        method: selectedMethod.name, account: accountNumber, amount: amount,
        status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      await db.ref(`withdrawals/pending/${reqId}`).set(newRequest);

      userTransactions.unshift(newRequest);
      renderWithdrawalHistory();

      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("‡¶ü‡¶æ‡¶ï‡¶æ ‡¶§‡ßã‡¶≤‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      document.getElementById('withdraw-form').reset();
    } catch (error) {
      userState.balance += amount;
      tg.HapticFeedback.notificationOccurred('error');
      tg.showAlert("‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡¶ø‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
    } finally {
      renderUI();
      btn.disabled = false;
      btn.textContent = '‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®';
    }
  };

  const copyReferralLink = () => {
    const refLinkInput = document.getElementById('referral-link');
    refLinkInput.select();
    refLinkInput.setSelectionRange(0, 99999);
    try {
      navigator.clipboard.writeText(refLinkInput.value).then(() => {
        tg.HapticFeedback.notificationOccurred('success');
        tg.showAlert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      });
    } catch (err) {
      document.execCommand('copy');
      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
    }
  };

  const renderLeaderboard = () => {
    const activeBoard = document.querySelector('.toggle-btn.active').dataset.board;
    const listEl = document.getElementById(activeBoard === 'referral' ? 'referral-leaderboard-list' : 'earning-leaderboard-list');
    const data = leaderboardData[activeBoard];
    document.getElementById('referral-board').style.display = activeBoard === 'referral' ? 'block' : 'none';
    document.getElementById('earning-board').style.display = activeBoard === 'earning' ? 'block' : 'none';
    listEl.innerHTML = '';
    if (data.length === 0) { listEl.innerHTML = '<li>‡¶ï‡ßã‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á‡•§</li>'; return; }
    data.forEach((user, index) => {
      const score = activeBoard === 'referral' ? (user.referrals || 0) : (user.totalEarned || 0).toFixed(2);
      const item = document.createElement('li'); item.className = 'leaderboard-item';
      item.innerHTML = `
        <span class="rank" style="width:36px;text-align:center;font-weight:800;color:var(--primary-color);font-size:1rem;">üèÖ #${index + 1}</span>
        <img src="${user.photoUrl || 'https://via.placeholder.com/50'}" alt="User" style="width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,0.2);margin-right:10px;">
        <span class="leaderboard-name" style="flex-grow:1;font-weight:600;font-size:0.95rem;">${user.firstName}</span>
        <span class="leaderboard-score" style="font-weight:700;color:var(--secondary-color);font-size:1rem;">${score}</span>`;
      listEl.appendChild(item);
    });
  };

  const renderDynamicTasks = () => {
    const container = document.getElementById('dynamic-tasks-container'); container.innerHTML = '';
    if (appConfig.tasks) {
      const tasks = [];
      for(const key in appConfig.tasks) { tasks.push({key, ...appConfig.tasks[key]}); }
      tasks.reverse();
      tasks.forEach(task => {
        const isCompleted = userState.completedTasks && userState.completedTasks[task.key];
        const el = document.createElement('div'); el.className = 'task-container';
        el.innerHTML = `
          <img class="task-icon-img" src="${task.icon}" alt="icon"
               style="width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(0,0,0,0.08);">
          <div class="task-info" style="flex-grow:1;">
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:5px;color:var(--primary-color);">${task.name}</h3>
            <p style="font-size:0.9rem;opacity:0.85;">üéÅ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® <b>${task.reward} ‡¶ü‡¶æ‡¶ï‡¶æ</b> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
          </div>
          <button class="action-btn" data-task-id="${task.key}" data-task-url="${task.url}" ${isCompleted ? 'disabled' : ''}
                  style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">
            ${isCompleted ? '‚úÖ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá' : 'üéØ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶®‡¶ø‡¶®'}
          </button>`;
        container.appendChild(el);
      });
    }
  };

  const renderReferralSection = () => {
    const container = document.getElementById('referral-section');
    const refLink = `https://t.me/${appConfig.botUsername}/app?startapp=${tgUser.id}`;
    container.innerHTML = `
      <div class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06); border: 1px solid var(--border-light);">
        <h3 style="margin-bottom: 8px; color: var(--primary-color); font-weight: 700; font-size: 1.1rem;">ü§ù ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <p style="font-size: 0.95rem; margin-bottom: 14px; opacity: 0.85;">
          ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá <b>${appConfig.referralBonus || 0} ‡¶ü‡¶æ‡¶ï‡¶æ</b> ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
        </p>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <input type="text" id="referral-link" value="${refLink}" readonly
                 style="padding:12px; text-align:center; border-radius:10px; border:1px dashed var(--primary-color); background:rgba(231,76,60,0.05); font-size:0.92rem; font-weight:600;">
          <button id="copy-ref-link-btn" class="action-btn" style="width:100%; border-radius:10px; font-weight:700; font-size:0.95rem;">
            üîó ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
          </button>
        </div>
        <small style="margin-top:10px; opacity:0.75; text-align:center; font-size:0.85rem;">üì¢ ‡¶ü‡¶ø‡¶™‡¶∏: ‡¶¨‡ßá‡¶∂‡¶ø ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶¨‡ßá‡¶∂‡¶ø ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®!</small>
      </div>`;
  };

  const renderWithdrawSection = () => {
    const container = document.getElementById('withdraw-section'); let optionsHtml = '';
    if (appConfig.withdrawMethods) {
      appConfig.withdrawMethods.forEach(method => { optionsHtml += `<option value="${method.name}">${method.name} (‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ${method.min} ‡¶ü‡¶æ‡¶ï‡¶æ)</option>`; });
    }

    const minRefs = appConfig.minimumWithdrawReferrals || 0;
    let referralNotice = '';
    if (minRefs > 0) {
      referralNotice = `<p style="font-size: 0.85rem; text-align: center; margin-bottom: 15px; opacity: 0.8;"><b>‡¶®‡ßã‡¶ü:</b> ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßç‡¶§‡¶§ <b>${minRefs}</b> ‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</p>`;
    }

    container.innerHTML = `
      <form id="withdraw-form" class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">
        <h3 style="margin-bottom: 12px; color: var(--primary-color); font-weight: 700;">üí∏ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß</h3>
        ${referralNotice}
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="withdraw-method" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label>
          <select id="withdraw-method" required style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); background:rgba(255,255,255,0.95); font-size:0.95rem;">${optionsHtml}</select>
        </div>
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="account-number" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ / ‡¶Ü‡¶á‡¶°‡¶ø</label>
          <input type="text" id="account-number" required placeholder="‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: 01XXXXXXXXX" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">
        </div>
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="amount" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‡¶ü‡¶æ‡¶ï‡¶æ)</label>
          <input type="number" step="any" id="amount" required placeholder="‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">
        </div>
        <button type="submit" id="withdraw-submit-btn" class="action-btn" style="width:100%; margin-top:6px; border-radius:10px; font-weight:700; font-size:1rem;">‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
        <p style="font-size:0.85rem; text-align:center; margin-top:15px; opacity:0.8;">
          <b>‡¶®‡ßã‡¶ü:</b> ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶¨‡ßá‡•§
        </p>
      </form>`;
  };

  const renderDynamicLinks = () => {
    const container = document.getElementById('dynamic-links-container'); container.innerHTML = '';
    if (appConfig.links) {
      const links = [];
      for (const key in appConfig.links) { links.push({key, ...appConfig.links[key]}); }
      links.reverse();
      links.forEach(link => {
        const el = document.createElement('div'); el.className = 'task-container';
        el.innerHTML = `
          <img class="task-icon-img" src="${link.icon}" alt="icon" style="width:48px;height:48px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 6px rgba(0,0,0,0.08);">
          <div class="task-info" style="flex-grow:1;">
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:4px;color:var(--primary-color);">${link.name}</h3>
            <p style="font-size:0.9rem;opacity:0.8;">‡¶Ü‡¶∞‡¶ì ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶¨‡¶æ ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßç‡¶≤‡ßã‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</p>
          </div>
          <button class="action-btn" onclick="window.Telegram.WebApp.openLink('${link.url}')" style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">üåê ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü</button>`;
        container.appendChild(el);
      });
    }
  };

  initApp();
});
</script> -->
</body>
</html>