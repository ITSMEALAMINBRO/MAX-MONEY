<!DOCTYPE html>  
<html lang="bn">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <title>অ্যাডমিন প্যানেল</title>  
  <link rel="preconnect" href="https://fonts.googleapis.com">  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+Bengali:wght@400;600;700&display=swap" rel="stylesheet">  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>  
  
  <style>  
    /* ========== THEME TOKENS (New Palette) ========== */  
    :root{  
      --bg: #060712;  
      --glass: rgba(255,255,255,.08);  
      --glass-2: rgba(255,255,255,.14);  
      --stroke: rgba(255,255,255,.22);  
      --txt: #EAF2FF;  
      --muted: #C6D0EB;  
  
      --pri: #7CFFCF;       /* Mint neon */  
      --pri-2: #42A5F5;     /* Blue */  
      --acc: #A78BFA;       /* Purple */  
      --warn: #F59E0B;      /* Amber */  
      --ok: #22C55E;        /* Green */  
      --err: #EF4444;       /* Red */  
  
      --soft-shadow: 0 8px 30px rgba(0,0,0,.30), inset 0 0 0 1px rgba(255,255,255,.06);  
      --card-radius: 18px;  
      --item-radius: 14px;  
    }  
  
    *{margin:0;padding:0;box-sizing:border-box}  
    body{  
      font-family:'Noto Sans Bengali','Poppins',sans-serif;  
      background: var(--bg);  
      color: var(--txt);  
      min-height: 100vh;  
      overflow-x: hidden;  
    }  
    #app-container{transition:filter .3s;}  
  
    /* ===== Animated Aurora Background ===== */  
    .aurora{  
      position: fixed; inset: -20% -20% -20% -20%;  
      background:  
        radial-gradient(60% 40% at 20% 10%, rgba(124,255,207,.22), transparent 60%),  
        radial-gradient(50% 30% at 80% 10%, rgba(66,165,245,.20), transparent 60%),  
        radial-gradient(60% 50% at 20% 80%, rgba(167,139,250,.18), transparent 60%),  
        radial-gradient(50% 40% at 80% 80%, rgba(245,158,11,.14), transparent 60%);  
      filter: blur(50px) saturate(120%);  
      animation: drift 22s ease-in-out infinite alternate;  
      pointer-events: none;  
      z-index: 0;  
      opacity: .9;  
    }  
    @keyframes drift{  
      0%   { transform: translate3d(-2%, -2%, 0) scale(1); }  
      100% { transform: translate3d(2%,  2%,  0) scale(1.05); }  
    }  
  
    /* ===== Top bar (mobile) – glass chip ===== */  
    #top-bar{  
      position:sticky; top:0; z-index:1100;  
      height:64px; padding:0 16px;  
      display:flex; align-items:center; gap:12px;  
      color:#fff;  
      backdrop-filter: blur(14px);  
      background: linear-gradient(90deg, rgba(124,255,207,.16), rgba(167,139,250,.16));  
      border-bottom: 1px solid var(--stroke);  
      box-shadow: var(--soft-shadow);  
    }  
    #menu-toggle{  
      background:linear-gradient(135deg, rgba(124,255,207,.22), rgba(66,165,245,.22));  
      border:1px solid var(--stroke);  
      color:#fff; width:42px; height:42px; border-radius:12px; cursor:pointer;  
    }  
    #page-title{font-size:1.1rem; font-weight:800; letter-spacing:.3px}  
  
    /* ===== Sidebar – Neo Glass Rail ===== */  
    #sidebar{  
      position:fixed; top:14px; left:14px; bottom:14px;  
      width: 290px;  
      z-index:1200;  
      transform: translateX(calc(-100% - 14px));  
      transition: transform .38s cubic-bezier(.2,.8,.2,1);  
      display:flex; flex-direction:column;  
      backdrop-filter: blur(18px) saturate(140%);  
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));  
      border: 1px solid var(--stroke);  
      border-radius: 22px;  
      box-shadow: var(--soft-shadow);  
    }  
    #sidebar.open{ transform: translateX(0) }  
    #sidebar-header{padding:20px 18px 8px; position:relative;}  
    #sidebar-header h2{font-size:1.05rem; font-weight:800; letter-spacing:.25px}  
    #sidebar-header .close-btn{  
      position:absolute; top:14px; right:14px; font-size:1.6rem; cursor:pointer; opacity:.9  
    }  
    .nav-menu{list-style:none; padding:10px 10px 16px; margin:0; overflow:auto}  
    .nav-menu li{  
      display:flex; align-items:center; gap:12px;  
      padding:12px 12px; margin:6px 4px;  
      border-radius: 12px;  
      background: transparent;  
      color: var(--muted);  
      border: 1px dashed transparent;  
      transition: all .18s ease;  
      cursor: pointer;  
    }  
    .nav-menu li i{  
      width:24px; text-align:center; font-size:1.08rem;  
      color: #E4ECFF;  
      filter: drop-shadow(0 4px 8px rgba(66,165,245,.15));  
    }  
    .nav-menu li:hover{  
      background: var(--glass);  
      border-color: rgba(255,255,255,.12);  
      color: #fff;  
    }  
    .nav-menu li.active{  
      background: linear-gradient(95deg, rgba(124,255,207,.22), rgba(66,165,245,.22));  
      border-color: rgba(255,255,255,.22);  
      color: #fff;  
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 8px 18px rgba(124,255,207,.12);  
    }  
  
    /* ===== Overlay for mobile ===== */  
    #overlay{  
      position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:1150; display:none  
    }  
    #overlay.show{display:block}  
  
    /* ===== Content area ===== */  
    #content-wrapper{position:relative; z-index:1; width:100%;}  
    #main-content{padding:18px; max-width:1200px; margin: 0 auto;}  
    .page{display:none}.page.active{display:block;animation: fade .4s ease}  
    @keyframes fade{from{opacity:0; transform: translateY(8px)}to{opacity:1; transform: translateY(0)}}  
  
    /* ===== Card – frosted panels ===== */  
    .card{  
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));  
      border-radius: var(--card-radius);  
      padding: 20px;  
      border: 1px solid var(--stroke);  
      box-shadow: var(--soft-shadow);  
    }  
    h1,h3,h4{color:#F7FAFF; margin-bottom:12px}  
    h3{font-weight:800}  
  
    /* ===== KPI Grid – glowing tiles ===== */  
    .kpi-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}  
    .kpi{  
      border-radius:16px;  
      padding:18px;  
      background:  
        radial-gradient(120% 100% at 0% 0%, rgba(124,255,207,.18), transparent 60%),  
        radial-gradient(120% 100% at 100% 0%, rgba(66,165,245,.16), transparent 60%),  
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));  
      border:1px solid var(--stroke);  
      box-shadow: var(--soft-shadow);  
      overflow:hidden;  
      position: relative;  
    }  
    .kpi::after{  
      content:""; position:absolute; inset:0;  
      background: radial-gradient(60% 40% at 70% -10%, rgba(167,139,250,.16), transparent 60%);  
      mix-blend-mode: screen; pointer-events:none;  
    }  
    .kpi h4{font-size:.92rem; color: var(--muted); margin-bottom:8px}  
    .kpi .v{font-size:1.9rem; font-weight:800; color:#DFF8FF; text-shadow: 0 6px 18px rgba(124,255,207,.22)}  
  
    /* ===== Table – glass rows (mobile-first) ===== */  
    table{width:100%;border-collapse:collapse}  
    thead{display:none}  
    tr{  
      display:block; margin-bottom:14px;  
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));  
      border:1px solid var(--stroke); border-radius:12px; padding:12px;  
      box-shadow: var(--soft-shadow);  
    }  
    td{  
      display:flex; justify-content:space-between; align-items:center;  
      padding:8px 0; border-bottom:1px dashed rgba(255,255,255,.14)  
    }  
    td:last-child{border-bottom:none}  
    td::before{content:attr(data-label); font-weight:700; color:#BFD8FF; margin-right:10px}  
  
    /* ===== Buttons ===== */  
    .action-buttons{text-align:right;width:100%}  
    .action-btn{  
      padding:10px 14px; border:none; border-radius:12px; color:#0B1222; cursor:pointer; margin:3px;  
      font-weight:800; letter-spacing:.1px;  
      box-shadow: 0 10px 24px rgba(0,0,0,.25);  
      transition: transform .12s ease, filter .12s ease;  
      background: linear-gradient(135deg, #E4FFF6, #DDEBFF);  
    }  
    .action-btn:active{transform: translateY(1px)}  
    .btn-success{ background: linear-gradient(135deg, #B9F6CA, #D7FFE6); color:#064E3B }  
    .btn-danger { background: linear-gradient(135deg, #FFE1E1, #FFD4D4); color:#7F1D1D }  
    .btn-primary{ background: linear-gradient(135deg, #B3E7FF, #E3D9FF); color:#0F172A }  
  
    /* ===== Forms ===== */  
    .form-group{margin-bottom:14px}  
    .form-group label{display:block;margin-bottom:6px;font-weight:700;color:#DDE7FF}  
    .form-group input,.form-group textarea,.form-group select{  
      width:100%; padding:12px 14px; border-radius:14px;  
      background: rgba(255,255,255,.06);  
      color:#F1F6FF;  
      border:1px solid var(--stroke);  
      outline:none;  
      transition: box-shadow .15s ease, border-color .15s ease;  
    }  
    .form-group input::placeholder,.form-group textarea::placeholder{color:#AFC7EC}  
    .form-group input:focus,.form-group textarea:focus,.form-group select:focus{  
      box-shadow: 0 0 0 4px rgba(66,165,245,.18);  
      border-color: rgba(124,255,207,.6);  
    }  
  
    /* ===== Login Panel – spotlight card ===== */  
    #login-screen{  
      max-width:520px; margin:10vh auto 6vh; padding:26px;  
      background: radial-gradient(120% 120% at 0% 0%, rgba(124,255,207,.10), transparent 60%),   
                  linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));  
      border-radius: 22px;  
      border: 1px solid var(--stroke);  
      box-shadow: var(--soft-shadow);  
      position: relative; overflow: hidden;  
    }  
    #login-screen::before{  
      content:""; position:absolute; inset:-40% -30% auto auto; height:240px; width:240px; border-radius:50%;  
      background: radial-gradient(closest-side, rgba(167,139,250,.45), transparent);  
      filter: blur(30px);  
      animation: orb 10s ease-in-out infinite alternate;  
    }  
    @keyframes orb { from{transform: translateY(-12px)} to{ transform: translateY(12px)} }  
    #login-screen h2{margin-bottom:12px; font-weight:800}  
    #login-btn{  
      width:100%; padding:12px; border:none; border-radius:14px;  
      background: linear-gradient(90deg, #7CFFCF, #42A5F5, #A78BFA);  
      color:#0A1020; font-weight:900; cursor:pointer; letter-spacing:.2px;  
      box-shadow: 0 14px 32px rgba(124,255,207,.18);  
    }  
    #login-error{color:#FFD2D2;margin-top:10px;display:none;font-weight:700}  
  
    /* ===== Desktop layout ===== */  
    @media (min-width: 1024px){  
      #app-container{display:flex}  
      #top-bar{display:none}  
      #sidebar{transform: translateX(0)}  
      #sidebar-header .close-btn{display:none}  
      #main-content{padding:30px}  
      thead{display:table-header-group}  
      tr{display:table-row;margin-bottom:0;border:none;padding:0;background:transparent; box-shadow:none}  
      td{display:table-cell;padding:12px;border-bottom:1px solid rgba(255,255,255,.1)}  
      td::before{display:none}  
      .action-buttons{text-align:left}  
      .kpi-grid{grid-template-columns:repeat(4,1fr)}  
    }  
  </style>  
</head>  
<body>  
  <!-- Animated Background -->  
  <div class="aurora"></div>  
  
  <!-- Login Screen -->  
  <div id="login-screen">  
    <h2><i class="fas fa-shield-halved"></i> অ্যাডমিন লগইন</h2>  
    <div class="form-group">  
      <label>ইমেইল</label>  
      <input id="login-email" type="email" placeholder="admin@example.com">  
    </div>  
    <div class="form-group">  
      <label>পাসওয়ার্ড</label>  
      <input id="login-password" type="password" placeholder="••••••••">  
    </div>  
    <button id="login-btn">লগইন</button>  
    <p id="login-error"></p>  
  </div>  
  
  <!-- Admin App -->  
  <div id="app-container" style="display:none;">  
    <aside id="sidebar">  
      <div>  
        <div id="sidebar-header">  
          <h2><i class="fas fa-sparkles"></i> অ্যাডমিন প্যানেল</h2>  
          <span class="close-btn">&times;</span>  
        </div>  
        <ul class="nav-menu">  
          <li data-page="dashboard" class="active"><i class="fas fa-gauge-high"></i> ড্যাশবোর্ড</li>  
          <li data-page="users"><i class="fas fa-users"></i> ব্যবহারকারী</li>  
          <li data-page="withdrawals"><i class="fas fa-wallet"></i> অপেক্ষমাণ উত্তোলন</li>  
          <li data-page="history"><i class="fas fa-clock-rotate-left"></i> উত্তোলন ইতিহাস</li>  
          <li data-page="tasks"><i class="fas fa-list-check"></i> টাস্ক ও লিংক</li>  
          <li data-page="settings"><i class="fas fa-sliders"></i> অ্যাপ সেটিংস</li>  
          <li id="logout-btn"><i class="fas fa-right-from-bracket"></i> লগআউট</li>  
        </ul>  
      </div>  
    </aside>  
  
    <div id="overlay"></div>  
  
    <div id="content-wrapper">  
      <header id="top-bar">  
        <button id="menu-toggle"><i class="fas fa-bars"></i></button>  
        <h1 id="page-title">ড্যাশবোর্ড</h1>  
      </header>  
      <main id="main-content"></main>  
    </div>  
  </div>  
  
  <!-- Firebase SDKs -->  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>  
  
  <script>  
  document.addEventListener('DOMContentLoaded', () => {  
    /* ===== Firebase (unchanged) ===== */  
    const firebaseConfig = {
  apiKey: "AIzaSyDMB0EdRB1NCVa2nsJmzb9gxSIZ5z-zVlI",
  authDomain: "max-money-2k07.firebaseapp.com",
  databaseURL: "https://max-money-2k07-default-rtdb.firebaseio.com",
  projectId: "max-money-2k07",
  storageBucket: "max-money-2k07.firebasestorage.app",
  messagingSenderId: "203429901779",
  appId: "1:203429901779:web:745f5a46e5ea16babceb26",
  measurementId: "G-3YGPYQEXFY"
};
    firebase.initializeApp(firebaseConfig);  
  
    const db   = firebase.database();  
    const auth = firebase.auth();  
  
    const ADMIN_UID = '7911101227'; // শুধুমাত্র এই UID অ্যাডমিন  
  
    const mainContent = document.getElementById('main-content');  
    const pageTitle   = document.getElementById('page-title');  
    const sidebar     = document.getElementById('sidebar');  
    const overlay     = document.getElementById('overlay');  
  
    const loginScreen  = document.getElementById('login-screen');  
    const appContainer = document.getElementById('app-container');  
    const loginBtn     = document.getElementById('login-btn');  
    const loginEmail   = document.getElementById('login-email');  
    const loginPass    = document.getElementById('login-password');  
    const loginErr     = document.getElementById('login-error');  
  
    /* ===== Login ===== */  
    loginBtn.addEventListener('click', async () => {  
      loginErr.style.display = 'none';  
      try {  
        await auth.signInWithEmailAndPassword(loginEmail.value.trim(), loginPass.value);  
      } catch (e) {  
        loginErr.textContent = e && e.message ? e.message : 'লগইন ব্যর্থ হয়েছে';  
        loginErr.style.display = 'block';  
      }  
    });  
  
    /* ===== Auth Gate ===== */  
    auth.onAuthStateChanged(async (user) => {  
      if (!user) {  
        appContainer.style.display = 'none';  
        loginScreen.style.display  = 'block';  
        return;  
      }  
      const isAdmin = (user.uid === ADMIN_UID);  
      if (!isAdmin) {  
        await auth.signOut();  
        loginErr.textContent = 'অ্যাডমিন এক্সেস অনুমোদিত নয়।';  
        loginErr.style.display = 'block';  
        return;  
      }  
      loginScreen.style.display  = 'none';  
      appContainer.style.display = 'flex';  
      initAdminPanelSafe();  
    });  
  
    // Logout  
    document.addEventListener('click', (e) => {  
      if (e.target.closest('#logout-btn')) { auth.signOut(); }  
    });  
  
    /* ===== Renderers (Bengali UI) ===== */  
    const renderDashboard = async () => {  
      const usersSnap = await db.ref('users').once('value');  
      const withdrawalsSnap = await db.ref('withdrawals/pending').once('value');  
      mainContent.innerHTML = `  
        <div id="dashboard" class="page active">  
          <div class="kpi-grid">  
            <div class="kpi"><h4>মোট ব্যবহারকারী</h4><div class="v">${usersSnap.numChildren()}</div></div>  
            <div class="kpi"><h4>অপেক্ষমাণ উত্তোলন</h4><div class="v">${withdrawalsSnap.numChildren()}</div></div>  
            <div class="kpi"><h4>আজকের তারিখ</h4><div class="v">${new Date().toLocaleDateString('bn-BD')}</div></div>  
            <div class="kpi"><h4>সময়</h4><div class="v">${new Date().toLocaleTimeString('bn-BD')}</div></div>  
          </div>  
          <div class="card" style="margin-top:16px">  
            <h3>স্বাগতম!</h3>  
            <p style="color:#CFE2FF">এই ড্যাশবোর্ড থেকে ব্যবহারকারী/টাস্ক/লিংক/উত্তোলন/সেটিংস সব ম্যানেজ করতে পারবেন।</p>  
          </div>  
        </div>`;  
    };  
  
    const renderUsers = async () => {  
      mainContent.innerHTML = '<div class="card"><h3>ব্যবহারকারী লোড হচ্ছে…</h3></div>';  
      const snap = await db.ref('users').orderByChild('firstName').once('value'); let tableContent = '';  
      snap.forEach(child => {  
        const user = child.val();  
        tableContent += `<tr>  
            <td data-label="ব্যবহারকারী">${user.firstName || ''} ${user.lastName || ''}<br><small style="color:#9EB8E8">${user.id}</small></td>  
            <td data-label="ব্যালেন্স">${(user.balance || 0).toFixed(2)} টাকা</td>  
            <td data-label="রেফারেল">${user.referrals || 0}</td>  
            <td data-label="অ্যাকশন">  
              <div class="action-buttons">  
                <button class="action-btn btn-primary" onclick="window.adminActions.editUserBalance('${user.id}', '${user.firstName || ''}')">ব্যালেন্স পরিবর্তন</button>  
              </div>  
            </td>  
        </tr>`;  
      });  
      mainContent.innerHTML = `<div id="users" class="page active">  
        <h3>সকল ব্যবহারকারী</h3>  
        <div class="card">  
          <table>  
            <thead><tr><th>ব্যবহারকারী</th><th>ব্যালেন্স</th><th>রেফারেল</th><th>অ্যাকশন</th></tr></thead>  
            <tbody>${tableContent}</tbody>  
          </table>  
        </div>  
      </div>`;  
    };  
  
    const renderWithdrawals = async () => {  
      mainContent.innerHTML = '<div class="card"><h3>অনুরোধ লোড হচ্ছে…</h3></div>';  
      const snap = await db.ref('withdrawals/pending').orderByChild('timestamp').once('value'); let tableContent = '';  
      let requests = [];  
      snap.forEach(child => { requests.push(child.val()); });  
      requests.reverse();  
      requests.forEach(req => {  
        tableContent += `<tr>  
          <td data-label="ব্যবহারকারী">${req.userName}<br><small style="color:#9EB8E8">${new Date(req.timestamp).toLocaleString('bn-BD')}</small></td>  
          <td data-label="পরিমাণ"><b>${req.amount.toFixed(2)} টাকা</b><br><small style="color:#CFE2FF">${req.method} | ${req.account}</small></td>  
          <td data-label="অ্যাকশন">  
            <div class="action-buttons">  
              <button class="action-btn btn-success" onclick="window.adminActions.handleWithdrawal('${req.id}', 'approve')">অনুমোদন</button>  
              <button class="action-btn btn-danger"  onclick="window.adminActions.handleWithdrawal('${req.id}', 'reject')">বাতিল</button>  
            </div>  
          </td>  
        </tr>`;  
      });  
      mainContent.innerHTML = `<div id="withdrawals" class="page active">  
        <h3>অপেক্ষমাণ উত্তোলন</h3>  
        <div class="card">  
          <table>  
            <thead><tr><th>ব্যবহারকারী ও তারিখ</th><th>পরিমাণ ও বিস্তারিত</th><th>অ্যাকশন</th></tr></thead>  
            <tbody>${tableContent || '<tr><td colspan=3>কোনও অপেক্ষমাণ অনুরোধ নেই</td></tr>'}</tbody>  
          </table>  
        </div>  
      </div>`;  
    };  
  
    const renderWithdrawalHistory = async () => {  
      mainContent.innerHTML = '<div class="card"><h3>ইতিহাস লোড হচ্ছে…</h3></div>';  
      const completedSnap = await db.ref('withdrawals/completed').orderByChild('timestamp').limitToLast(100).once('value');  
      const rejectedSnap  = await db.ref('withdrawals/rejected').orderByChild('timestamp').limitToLast(100).once('value');  
      let completedRows = '', rejectedRows = '';  
      let completed = []; completedSnap.forEach(ch => completed.push(ch.val())); completed.reverse();  
      completed.forEach(req => { completedRows += `<tr><td data-label="ব্যবহারকারী">${req.userName}</td><td data-label="পরিমাণ">${req.amount.toFixed(2)} টাকা</td><td data-label="তারিখ">${new Date(req.timestamp).toLocaleDateString('bn-BD')}</td><td data-label="স্ট্যাটাস">সম্পন্ন</td></tr>`; });  
      let rejected  = []; rejectedSnap.forEach(ch => rejected.push(ch.val())); rejected.reverse();  
      rejected.forEach(req  => { rejectedRows  += `<tr><td data-label="ব্যবহারকারী">${req.userName}</td><td data-label="পরিমাণ">${req.amount.toFixed(2)} টাকা</td><td data-label="তারিখ">${new Date(req.timestamp).toLocaleDateString('bn-BD')}</td><td data-label="স্ট্যাটাস">বাতিল</td></tr>`; });  
  
      mainContent.innerHTML = `  
        <div id="history" class="page active"><h3>উত্তোলন ইতিহাস</h3>  
          <div class="card"><h4>সম্পন্ন অনুরোধ</h4>  
            <table><thead><tr><th>ব্যবহারকারী</th><th>পরিমাণ</th><th>তারিখ</th><th>স্ট্যাটাস</th></tr></thead><tbody>${completedRows || '<tr><td colspan="4">কোনও সম্পন্ন অনুরোধ নেই।</td></tr>'}</tbody></table>  
          </div>  
          <div class="card"><h4>বাতিল অনুরোধ</h4>  
            <table><thead><tr><th>ব্যবহারকারী</th><th>পরিমাণ</th><th>তারিখ</th><th>স্ট্যাটাস</th></tr></thead><tbody>${rejectedRows || '<tr><td colspan="4">কোনও বাতিল অনুরোধ নেই।</td></tr>'}</tbody></table>  
          </div>  
        </div>`;  
    };  
  
    const renderTasks = async () => {  
      mainContent.innerHTML = `  
        <div id="tasks" class="page active"><h3>টাস্ক ও লিংক ম্যানেজ</h3>  
          <div class="card" id="tasks-list"><h4>টাস্ক লোড হচ্ছে…</h4></div>  
          <div class="card"><h4>নতুন টাস্ক যোগ করুন</h4>  
            <div class="form-group"><input id="task-name" placeholder="টাস্ক নাম (যেমন: টেলিগ্রাম জয়েন)"></div>  
            <div class="form-group"><input id="task-url"  placeholder="URL"></div>  
            <div class="form-group"><input id="task-reward" type="number" placeholder="রিওয়ার্ড (টাকা)"></div>  
            <div class="form-group"><input id="task-icon"   placeholder="আইকন ইমেজ URL"></div>  
            <button class="action-btn btn-primary" onclick="window.adminActions.addTask()">টাস্ক যোগ করুন</button>  
          </div>  
          <div class="card" id="links-list"><h4>লিংক লোড হচ্ছে…</h4></div>  
          <div class="card"><h4>নতুন লিংক/বোতাম যোগ করুন</h4>  
            <div class="form-group"><input id="link-name" placeholder="বোতামের নাম (যেমন: অফিসিয়াল চ্যানেল)"></div>  
            <div class="form-group"><input id="link-url"  placeholder="URL"></div>  
            <div class="form-group"><input id="link-icon" placeholder="আইকন ইমেজ URL"></div>  
            <button class="action-btn btn-primary" onclick="window.adminActions.addLink()">লিংক যোগ করুন</button>  
          </div>  
        </div>`;  
      loadDynamicContent('tasks'); loadDynamicContent('links');  
    };  
  
    const renderSettings = async () => {  
      const snap = await db.ref('config').once('value'); 
      const config = snap.val() || {};  
      const support = config.support || {};  /* ✅ ধাপ ১: support অবজেক্ট সেফলি বের করা */
      mainContent.innerHTML = `<div id="settings" class="page active"><h3>অ্যাপ সেটিংস</h3>  
        <div class="card">  
        <hr style="border:none;border-top:1px dashed rgba(255,255,255,.2);margin:14px 0">  
      <h4>সাপোর্ট লিংক</h4>  
      <div class="form-group">  
        <label>সাপোর্ট টেলিগ্রাম URL</label>  
        <input type="url" id="supportTelegramUrl" placeholder="https://t.me/YourSupportBot"  
               value="${support.telegramUrl || ''}">  
      </div>  
      <div class="form-group">  
        <label>সাপোর্ট ইমেইল</label>  
        <input type="email" id="supportEmail" placeholder="support@bootex.app"  
               value="${support.email || ''}">  
      </div>  
  
          <div class="form-group"><label>বট ইউজারনেম (@ ছাড়া)</label><input type="text" id="botUsername" value="${config.botUsername || ''}"></div>  
          <hr style="border:none;border-top:1px dashed rgba(255,255,255,.2);margin:14px 0">  
          <h4>API ও বিজ্ঞাপন সেটিংস</h4>  
          <div class="form-group"><label>টেলিগ্রাম বট টোকেন</label><input type="text" id="botToken" value="${config.botToken || ''}"></div>  
          <div class="form-group"><label>অ্যাড নেটওয়ার্ক Zone ID</label><input type="number" id="adZoneId" value="${config.adZoneId || ''}"></div>  
          <div class="form-group"><label>ওয়েলকাম মেসেজ</label><textarea id="welcomeMessage">${config.welcomeMessage || ''}</textarea></div>  
          <hr style="border:none;border-top:1px dashed rgba(255,255,255,.2);margin:14px 0">  
          <h4>আয় সেটিংস</h4>  
          <div class="form-group"><label>প্রতি বিজ্ঞাপনে আয়</label><input type="number" step="any" id="adValue" value="${config.adValue || 0}"></div>  
          <div class="form-group"><label>রেফারেল বোনাস</label><input type="number" step="any" id="referralBonus" value="${config.referralBonus || 0}"></div>  
          <div class="form-group"><label>দৈনিক বিজ্ঞাপন সীমা</label><input type="number" id="dailyAdLimit" value="${config.dailyAdLimit || 0}"></div>  
          <div class="form-group"><label>কতগুলো বিজ্ঞাপনের পর বিরতি</label><input type="number" id="adsPerBreak" value="${config.adsPerBreak || 0}"></div>  
          <div class="form-group"><label>বিরতির সময় (মিনিট)</label><input type="number" id="breakDuration" value="${config.breakDuration || 0}"></div>  
          <hr style="border:none;border-top:1px dashed rgba(255,255,255,.2);margin:14px 0">  
          <h4>উত্তোলন সেটিংস</h4>  
          <div class="form-group"><label>উইথড্র করতে ন্যূনতম রেফারেল</label><input type="number" id="minimumWithdrawReferrals" value="${config.minimumWithdrawReferrals || 0}"></div>  
          <div id="withdraw-methods-container"></div>  
          <button class="action-btn btn-primary" onclick="window.adminActions.addWithdrawMethodField()">+ পদ্ধতি যোগ করুন</button>  
          <hr style="border:none;border-top:1px dashed rgba(255,255,255,.2);margin:18px 0">  
          <button class="action-btn btn-success" style="width:100%;padding:14px" onclick="window.adminActions.saveSettings()">সব সেটিংস সেভ করুন</button>  
        </div></div>`;  
      renderWithdrawMethods(config.withdrawMethods);  
    };  
  
    const renderBroadcast = () => {  
      mainContent.innerHTML = `<div id="broadcast" class="page active"><h3>ব্রডকাস্ট মেসেজ</h3>  
        <div class="card"><p style="color:#CFE2FF">এই মেসেজটি সকল ব্যবহারকারীর কাছে যাবে। <strong>নোট:</strong> সঠিকভাবে কাজ করতে সার্ভার-সাইড ফাংশন (যেমন Firebase Cloud Functions) প্রয়োজন।</p>  
          <div class="form-group"><textarea id="broadcast-message" rows="5" placeholder="এখানে আপনার মেসেজ লিখুন…"></textarea></div>  
          <button class="action-btn btn-danger" onclick="window.adminActions.sendBroadcast()">ব্রডকাস্ট কিউ করুন</button>  
        </div></div>`;  
    };  
  
    /* ===== Helpers ===== */  
    const loadDynamicContent = async (type) => {  
      const container = document.getElementById(`${type}-list`);  
      const snap = await db.ref(`config/${type}`).once('value');  
      let items = [];  
      snap.forEach(child => { items.push({ key: child.key, ...child.val() }); });  
      items.reverse();  
      let title = type === 'tasks' ? 'বর্তমান টাস্ক' : 'বর্তমান লিংক/বোতাম';  
      let content = `<h4>${title}</h4>`;  
      if (items.length > 0) {  
        content += '<ul class="dynamic-item-list">';  
        items.forEach(item => {  
          content += `<li>${item.name}  
            <button class="action-btn btn-danger" style="padding:8px 10px" onclick="window.adminActions.deleteDynamicItem('${type}', '${item.key}')" title="মুছুন">  
              <i class="fas fa-trash"></i>  
            </button>  
          </li>`;  
        });  
        content += '</ul>';  
      } else {  
        content += `<p style="color:#CFE2FF">কিছু পাওয়া যায়নি।</p>`;  
      }  
      container.innerHTML = content;  
    };  
  
    const renderWithdrawMethods = (methods) => {  
      const container = document.getElementById('withdraw-methods-container'); container.innerHTML = '';  
      if (methods) {  
        methods.forEach((method, index) => {  
          container.innerHTML += `<div class="withdraw-method-group" data-index="${index}" style="gap:10px">  
            <input value="${method.name || ''}" placeholder="পদ্ধতির নাম">  
            <input type="number" step="any" value="${method.min || ''}" placeholder="ন্যূনতম পরিমাণ">  
            <button class="action-btn btn-danger" onclick="this.parentElement.remove()">X</button>  
          </div>`;  
        });  
      }  
    };  
  
    /* ===== Actions (alerts in BN) ===== */  
    window.adminActions = {  
      editUserBalance: async (userId, userName) => {  
        const amount = prompt(`${userName} এর ব্যালেন্সে যোগ/বিয়োগ করতে পরিমাণ লিখুন।\nবিয়োগ করতে নেগেটিভ লিখুন (যেমন: -50)।`);  
        if (amount && !isNaN(parseFloat(amount))) {  
          try {  
            await db.ref(`users/${userId}/balance`).set(firebase.database.ServerValue.increment(parseFloat(amount)));  
            alert('ব্যালেন্স আপডেট হয়েছে!');  
            renderUsers();  
          } catch (e) {  
            alert('ত্রুটি হয়েছে। আবার চেষ্টা করুন।');  
          }  
        }  
      },  
      handleWithdrawal: async (reqId, action) => {  
        const reqRef = db.ref(`withdrawals/pending/${reqId}`);  
        const snap = await reqRef.once('value');  
        const request = snap.val();  
        if (!request) { alert('অনুরোধ খুঁজে পাওয়া যায়নি।'); return; }  
        if (action === 'reject') {  
          await db.ref(`users/${request.userId}/balance`).set(firebase.database.ServerValue.increment(request.amount));  
        }  
        const status = action === 'approve' ? 'completed' : 'rejected';  
        await db.ref(`withdrawals/${status}/${reqId}`).set({ ...request, status });  
        await reqRef.remove();  
        alert(`অনুরোধটি ${status === 'completed' ? 'সম্পন্ন' : 'বাতিল'} করা হয়েছে।`);  
        renderWithdrawals();  
      },  
      addTask: async () => {  
        const data = {  
          name: document.getElementById('task-name').value,  
          url: document.getElementById('task-url').value,  
          reward: parseFloat(document.getElementById('task-reward').value),  
          icon: document.getElementById('task-icon').value  
        };  
        if (!data.name || !data.url || !data.reward || !data.icon) { alert('সব ঘর পূরণ করুন।'); return; }  
        await db.ref('config/tasks').push(data);  
        alert('নতুন টাস্ক যোগ হয়েছে!');  
        renderTasks();  
      },  
      addLink: async () => {  
        const data = {  
          name: document.getElementById('link-name').value,  
          url: document.getElementById('link-url').value,  
          icon: document.getElementById('link-icon').value  
        };  
        if (!data.name || !data.url || !data.icon) { alert('নাম, URL ও আইকন URL প্রয়োজন।'); return; }  
        await db.ref('config/links').push(data);  
        alert('নতুন লিংক যোগ হয়েছে!');  
        renderTasks();  
      },  
      deleteDynamicItem: async (type, key) => {  
        if (confirm(`আপনি কি নিশ্চিতভাবে মুছতে চান?`)) {  
          await db.ref(`config/${type}/${key}`).remove();  
          alert('আইটেম মুছে ফেলা হয়েছে।');  
          renderTasks();  
        }  
      },  
      addWithdrawMethodField: () => {  
        document.getElementById('withdraw-methods-container').innerHTML +=  
          `<div class="withdraw-method-group" style="gap:10px">  
            <input placeholder="পদ্ধতির নাম">  
            <input type="number" placeholder="ন্যূনতম পরিমাণ">  
            <button class="action-btn btn-danger" onclick="this.parentElement.remove()">X</button>  
          </div>`;  
      },  
      saveSettings: async () => {  
        const withdrawMethods = [];  
        document.querySelectorAll('.withdraw-method-group').forEach(group => {  
          const name = group.children[0].value;  
          const min  = parseFloat(group.children[1].value);  
          if (name && min) { withdrawMethods.push({ name, min }); }  
        });  
        const settings = {  
          botUsername:   document.getElementById('botUsername').value,  
          botToken:      document.getElementById('botToken').value,  
          adZoneId:      document.getElementById('adZoneId').value,  
          welcomeMessage:document.getElementById('welcomeMessage').value,  
          adValue:       parseFloat(document.getElementById('adValue').value),  
          referralBonus: parseFloat(document.getElementById('referralBonus').value),  
          dailyAdLimit:  parseInt(document.getElementById('dailyAdLimit').value),  
          adsPerBreak:   parseInt(document.getElementById('adsPerBreak').value),  
          breakDuration: parseInt(document.getElementById('breakDuration').value),  
          minimumWithdrawReferrals: parseInt(document.getElementById('minimumWithdrawReferrals').value) || 0,  
          withdrawMethods: withdrawMethods,  
          /* ✅ ধাপ ১: support সেকশন সেভ */  
          support: {  
            telegramUrl: (document.getElementById('supportTelegramUrl')?.value || '').trim(),  
            email:       (document.getElementById('supportEmail')?.value       || '').trim()  
          }  
        };  
        await db.ref('config').update(settings);  
        alert('সেটিংস সফলভাবে সেভ হয়েছে!');  
      },  
      sendBroadcast: async () => {  
        const message = document.getElementById('broadcast-message').value;  
        if (!message || !confirm('আপনি কি নিশ্চিতভাবে এই ব্রডকাস্ট কিউ করতে চান?')) return;  
        await db.ref('broadcastQueue').push({ message, timestamp: Date.now(), status: 'pending' });  
        alert('ব্রডকাস্ট কিউতে যোগ হয়েছে। সার্ভার প্রসেস করবে।');  
      }  
    };  
  
    /* ===== Nav + Mobile Menu ===== */  
    const setupNavigation = () => {  
      const navLinks = document.querySelectorAll('.nav-menu li');  
      const pageMap  = {  
        dashboard: renderDashboard,  
        users: renderUsers,  
        withdrawals: renderWithdrawals,  
        history: renderWithdrawalHistory,  
        tasks: renderTasks,  
        settings: renderSettings,  
        broadcast: renderBroadcast  
      };  
      navLinks.forEach(link => {  
        link.addEventListener('click', (e) => {  
          const pageKey = e.currentTarget.dataset.page;  
          if (pageKey) {  
            navLinks.forEach(l => l.classList.remove('active'));  
            e.currentTarget.classList.add('active');  
            pageTitle.textContent = e.currentTarget.textContent.trim();  
            pageMap[pageKey]();  
            sidebar.classList.remove('open'); overlay.classList.remove('show');  
          }  
        });  
      });  
    };  
  
    const setupMobileMenu = () => {  
      const menuToggle = document.getElementById('menu-toggle');  
      const closeBtn   = document.querySelector('#sidebar .close-btn');  
      if (menuToggle) menuToggle.addEventListener('click', () => { sidebar.classList.add('open'); overlay.classList.add('show'); });  
      if (closeBtn)   closeBtn.addEventListener('click', () => { sidebar.classList.remove('open'); overlay.classList.remove('show'); });  
      overlay.addEventListener('click', () => { sidebar.classList.remove('open'); overlay.classList.remove('show'); });  
    };  
  
    function initAdminPanelSafe() {  
      setupNavigation();  
      setupMobileMenu();  
      renderDashboard();  
    }  
  });  
  </script>  
</body>  
</html>